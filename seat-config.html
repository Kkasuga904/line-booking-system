<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸­é…ç½®è¨­å®š - ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .config-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .config-panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .seat-section {
            margin-bottom: 30px;
        }
        
        .seat-section h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .seat-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .seat-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .seat-item:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .seat-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .seat-id {
            font-weight: bold;
            color: #495057;
        }
        
        .seat-capacity {
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .seat-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        .btn-icon:hover {
            background: rgba(0,0,0,0.1);
        }
        
        .btn-icon.edit {
            color: #007bff;
        }
        
        .btn-icon.delete {
            color: #dc3545;
        }
        
        .add-seat-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px dashed #007bff;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .actions-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .store-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .store-selector label {
            font-weight: 600;
            color: #856404;
        }
        
        .store-selector select {
            padding: 8px 15px;
            border: 2px solid #ffc107;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .preview-section h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .seat-preview {
            display: grid;
            gap: 10px;
        }
        
        .preview-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .preview-seat {
            width: 60px;
            height: 60px;
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            color: #333;
        }
        
        .success-message {
            display: none;
            padding: 15px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            color: #155724;
            margin-bottom: 20px;
        }
        
        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>âš™ï¸ å¸­é…ç½®è¨­å®š</h1>
            <div class="subtitle">åº—èˆ—ã”ã¨ã®å¸­ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</div>
        </div>
    </div>
    
    <div class="container">
        <!-- åº—èˆ—é¸æŠ -->
        <div class="config-panel">
            <div class="store-selector">
                <label>åº—èˆ—ã‚’é¸æŠ:</label>
                <select id="storeSelect" onchange="loadStoreLayout()">
                    <option value="default">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š</option>
                    <option value="store001">æ¸‹è°·åº—</option>
                    <option value="store002">æ–°å®¿åº—</option>
                    <option value="store003">æ± è¢‹åº—</option>
                    <option value="new">+ æ–°è¦åº—èˆ—è¿½åŠ </option>
                </select>
                <span id="storeStatus" style="color: #28a745; font-size: 14px;"></span>
            </div>
        </div>
        
        <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
        <div id="successMessage" class="success-message">
            âœ… è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼
        </div>
        
        <!-- å¸­é…ç½®è¨­å®š -->
        <div class="config-panel">
            <h2>å¸­é…ç½®è¨­å®š</h2>
            
            <!-- ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­ -->
            <div class="seat-section">
                <h3>ğŸª‘ ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­</h3>
                <div id="counterSeats" class="seat-list">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>å¸­ç•ªå·</label>
                        <input type="text" id="counterSeatId" placeholder="ä¾‹: C1">
                    </div>
                    <div class="form-group">
                        <label>å®šå“¡</label>
                        <select id="counterCapacity">
                            <option value="1">1å</option>
                            <option value="2">2å</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('counter')">+ å¸­ã‚’è¿½åŠ </button>
                </div>
            </div>
            
            <!-- ãƒ†ãƒ¼ãƒ–ãƒ«å¸­ -->
            <div class="seat-section">
                <h3>ğŸ½ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«å¸­</h3>
                <div id="tableSeats" class="seat-list">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>å¸­ç•ªå·</label>
                        <input type="text" id="tableSeatId" placeholder="ä¾‹: T1">
                    </div>
                    <div class="form-group">
                        <label>å®šå“¡</label>
                        <select id="tableCapacity">
                            <option value="2">2å</option>
                            <option value="4" selected>4å</option>
                            <option value="6">6å</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('table')">+ å¸­ã‚’è¿½åŠ </button>
                </div>
            </div>
            
            <!-- å€‹å®¤ -->
            <div class="seat-section">
                <h3>ğŸšª å€‹å®¤</h3>
                <div id="privateSeats" class="seat-list">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>å¸­ç•ªå·</label>
                        <input type="text" id="privateSeatId" placeholder="ä¾‹: P1">
                    </div>
                    <div class="form-group">
                        <label>å®šå“¡</label>
                        <select id="privateCapacity">
                            <option value="4">4å</option>
                            <option value="6" selected>6å</option>
                            <option value="8">8å</option>
                            <option value="10">10å</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('private')">+ å¸­ã‚’è¿½åŠ </button>
                </div>
            </div>
            
            <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
            <div class="preview-section">
                <h3>ğŸ“‹ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h3>
                <div class="seat-preview">
                    <div class="preview-row" id="previewCounter"></div>
                    <div class="preview-row" id="previewTable"></div>
                    <div class="preview-row" id="previewPrivate"></div>
                </div>
            </div>
            
            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="actions-row">
                <button class="btn btn-success" onclick="saveLayout()">ğŸ’¾ è¨­å®šã‚’ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="resetLayout()">ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
                <button class="btn btn-danger" onclick="clearLayout()">ğŸ—‘ï¸ å…¨å¸­å‰Šé™¤</button>
                <button class="btn btn-primary" onclick="window.location.href='/restaurant-admin.html'">ğŸ“Š ç®¡ç†ç”»é¢ã¸</button>
            </div>
        </div>
    </div>
    
    <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">å¸­ã®ç·¨é›†</h2>
            </div>
            <div class="form-group">
                <label>å¸­ç•ªå·</label>
                <input type="text" id="editSeatId">
            </div>
            <div class="form-group">
                <label>å®šå“¡</label>
                <select id="editCapacity">
                    <option value="1">1å</option>
                    <option value="2">2å</option>
                    <option value="4">4å</option>
                    <option value="6">6å</option>
                    <option value="8">8å</option>
                    <option value="10">10å</option>
                </select>
            </div>
            <div class="actions-row">
                <button class="btn btn-primary" onclick="updateSeat()">æ›´æ–°</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>
    
    <script>
        // ç¾åœ¨ã®åº—èˆ—ID
        let currentStoreId = 'default';
        
        // å¸­ãƒ‡ãƒ¼ã‚¿ï¼ˆåº—èˆ—ã”ã¨ã«ç®¡ç†ï¼‰
        let seatLayouts = {};
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
        const defaultLayout = {
            counter: [
                { id: 'C1', capacity: 1 },
                { id: 'C2', capacity: 1 },
                { id: 'C3', capacity: 1 },
                { id: 'C4', capacity: 1 }
            ],
            table: [
                { id: 'T1', capacity: 4 },
                { id: 'T2', capacity: 4 },
                { id: 'T3', capacity: 4 }
            ],
            private: [
                { id: 'P1', capacity: 6 },
                { id: 'P2', capacity: 8 }
            ]
        };
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadLayouts();
            loadStoreLayout();
        });
        
        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’èª­ã¿è¾¼ã¿
        function loadLayouts() {
            const saved = localStorage.getItem('seatLayouts');
            if (saved) {
                seatLayouts = JSON.parse(saved);
            } else {
                seatLayouts = { default: defaultLayout };
            }
        }
        
        // åº—èˆ—ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’èª­ã¿è¾¼ã¿
        function loadStoreLayout() {
            const storeId = document.getElementById('storeSelect').value;
            
            if (storeId === 'new') {
                const newStoreName = prompt('æ–°ã—ã„åº—èˆ—åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
                if (newStoreName) {
                    const newStoreId = 'store_' + Date.now();
                    const option = document.createElement('option');
                    option.value = newStoreId;
                    option.textContent = newStoreName;
                    
                    const select = document.getElementById('storeSelect');
                    select.insertBefore(option, select.lastElementChild);
                    select.value = newStoreId;
                    
                    currentStoreId = newStoreId;
                    seatLayouts[newStoreId] = JSON.parse(JSON.stringify(defaultLayout));
                } else {
                    document.getElementById('storeSelect').value = currentStoreId;
                    return;
                }
            } else {
                currentStoreId = storeId;
            }
            
            if (!seatLayouts[currentStoreId]) {
                seatLayouts[currentStoreId] = JSON.parse(JSON.stringify(defaultLayout));
            }
            
            renderSeats();
            updatePreview();
        }
        
        // å¸­ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderSeats() {
            const layout = seatLayouts[currentStoreId];
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­
            renderSeatSection('counterSeats', layout.counter, 'counter');
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«å¸­
            renderSeatSection('tableSeats', layout.table, 'table');
            
            // å€‹å®¤
            renderSeatSection('privateSeats', layout.private, 'private');
        }
        
        // å¸­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderSeatSection(containerId, seats, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = seats.map(seat => `
                <div class="seat-item">
                    <div class="seat-info">
                        <span class="seat-id">${seat.id}</span>
                        <span class="seat-capacity">${seat.capacity}å</span>
                    </div>
                    <div class="seat-actions">
                        <button class="btn-icon edit" onclick="editSeat('${type}', '${seat.id}')">âœï¸</button>
                        <button class="btn-icon delete" onclick="deleteSeat('${type}', '${seat.id}')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }
        
        // å¸­ã‚’è¿½åŠ 
        function addSeat(type) {
            const idInput = document.getElementById(`${type}SeatId`);
            const capacityInput = document.getElementById(`${type}Capacity`);
            
            const seatId = idInput.value.trim().toUpperCase();
            const capacity = parseInt(capacityInput.value);
            
            if (!seatId) {
                alert('å¸­ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const layout = seatLayouts[currentStoreId];
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            const exists = layout[type].some(s => s.id === seatId);
            if (exists) {
                alert('ã“ã®å¸­ç•ªå·ã¯æ—¢ã«å­˜åœ¨ã—ã¾ã™');
                return;
            }
            
            layout[type].push({ id: seatId, capacity: capacity });
            
            idInput.value = '';
            renderSeats();
            updatePreview();
        }
        
        // å¸­ã‚’å‰Šé™¤
        function deleteSeat(type, seatId) {
            if (confirm(`å¸­ ${seatId} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                const layout = seatLayouts[currentStoreId];
                layout[type] = layout[type].filter(s => s.id !== seatId);
                renderSeats();
                updatePreview();
            }
        }
        
        // å¸­ã‚’ç·¨é›†
        let editingType = null;
        let editingId = null;
        
        function editSeat(type, seatId) {
            const layout = seatLayouts[currentStoreId];
            const seat = layout[type].find(s => s.id === seatId);
            
            if (seat) {
                editingType = type;
                editingId = seatId;
                
                document.getElementById('editSeatId').value = seat.id;
                document.getElementById('editCapacity').value = seat.capacity;
                document.getElementById('editModal').classList.add('show');
            }
        }
        
        // å¸­ã‚’æ›´æ–°
        function updateSeat() {
            const newId = document.getElementById('editSeatId').value.trim().toUpperCase();
            const newCapacity = parseInt(document.getElementById('editCapacity').value);
            
            if (!newId) {
                alert('å¸­ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const layout = seatLayouts[currentStoreId];
            const seat = layout[editingType].find(s => s.id === editingId);
            
            if (seat) {
                seat.id = newId;
                seat.capacity = newCapacity;
                renderSeats();
                updatePreview();
                closeEditModal();
            }
        }
        
        // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editingType = null;
            editingId = null;
        }
        
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æ›´æ–°
        function updatePreview() {
            const layout = seatLayouts[currentStoreId];
            
            // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼å¸­
            document.getElementById('previewCounter').innerHTML = layout.counter.map(seat => `
                <div class="preview-seat">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}å</div>
                </div>
            `).join('');
            
            // ãƒ†ãƒ¼ãƒ–ãƒ«å¸­
            document.getElementById('previewTable').innerHTML = layout.table.map(seat => `
                <div class="preview-seat" style="border-color: #007bff;">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}å</div>
                </div>
            `).join('');
            
            // å€‹å®¤
            document.getElementById('previewPrivate').innerHTML = layout.private.map(seat => `
                <div class="preview-seat" style="border-color: #dc3545;">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}å</div>
                </div>
            `).join('');
        }
        
        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä¿å­˜
        function saveLayout() {
            localStorage.setItem('seatLayouts', JSON.stringify(seatLayouts));
            
            // ã‚µãƒ¼ãƒãƒ¼ã«ã‚‚ä¿å­˜
            fetch('/api/seat-layout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    storeId: currentStoreId,
                    layout: seatLayouts[currentStoreId]
                })
            }).then(() => {
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                const message = document.getElementById('successMessage');
                message.classList.add('show');
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
                
                document.getElementById('storeStatus').textContent = 'âœ… ä¿å­˜æ¸ˆã¿';
            }).catch(err => {
                console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err);
                alert('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ');
            });
        }
        
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
        function resetLayout() {
            if (confirm('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å¸­é…ç½®ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
                seatLayouts[currentStoreId] = JSON.parse(JSON.stringify(defaultLayout));
                renderSeats();
                updatePreview();
            }
        }
        
        // å…¨å¸­å‰Šé™¤
        function clearLayout() {
            if (confirm('ã™ã¹ã¦ã®å¸­ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                seatLayouts[currentStoreId] = {
                    counter: [],
                    table: [],
                    private: []
                };
                renderSeats();
                updatePreview();
            }
        }
    </script>
</body>
</html>