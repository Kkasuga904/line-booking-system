<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∏≠ÈÖçÁΩÆË®≠ÂÆö - „É¨„Çπ„Éà„É©„É≥ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .config-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .config-panel h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .seat-section {
            margin-bottom: 30px;
        }
        
        .seat-section h3 {
            color: #555;
            margin-bottom: 15px;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .seat-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .seat-item {
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .seat-item:hover {
            background: #e9ecef;
            border-color: #adb5bd;
        }
        
        .seat-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .seat-id {
            font-weight: bold;
            color: #495057;
        }
        
        .seat-capacity {
            background: #6c757d;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .seat-actions {
            display: flex;
            gap: 5px;
        }
        
        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.3s;
        }
        
        .btn-icon:hover {
            background: rgba(0,0,0,0.1);
        }
        
        .btn-icon.edit {
            color: #007bff;
        }
        
        .btn-icon.delete {
            color: #dc3545;
        }
        
        .add-seat-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding: 15px;
            background: #f0f8ff;
            border-radius: 8px;
            border: 2px dashed #007bff;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .form-group label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select {
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .actions-row {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }
        
        .store-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .store-selector label {
            font-weight: 600;
            color: #856404;
        }
        
        .store-selector select {
            padding: 8px 15px;
            border: 2px solid #ffc107;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .preview-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }
        
        .preview-section h3 {
            margin-bottom: 15px;
            color: #495057;
        }
        
        .seat-preview {
            display: grid;
            gap: 10px;
        }
        
        .preview-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .preview-seat {
            width: 60px;
            height: 60px;
            background: white;
            border: 2px solid #28a745;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-header {
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            color: #333;
        }
        
        .success-message {
            display: none;
            padding: 15px;
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 6px;
            color: #155724;
            margin-bottom: 20px;
        }
        
        .success-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>‚öôÔ∏è Â∏≠ÈÖçÁΩÆË®≠ÂÆö</h1>
            <div class="subtitle">Â∫óËàó„Åî„Å®„ÅÆÂ∏≠„É¨„Ç§„Ç¢„Ç¶„Éà„Çí„Ç´„Çπ„Çø„Éû„Ç§„Ç∫</div>
        </div>
    </div>
    
    <div class="container">
        <!-- Â∫óËàóÈÅ∏Êäû -->
        <div class="config-panel">
            <div class="store-selector">
                <label>Â∫óËàó„ÇíÈÅ∏Êäû:</label>
                <select id="storeSelect" onchange="loadStoreLayout()">
                    <option value="default">„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö</option>
                    <option value="store001">Ê∏ãË∞∑Â∫ó</option>
                    <option value="store002">Êñ∞ÂÆøÂ∫ó</option>
                    <option value="store003">Ê±†Ë¢ãÂ∫ó</option>
                    <option value="new">+ Êñ∞Ë¶èÂ∫óËàóËøΩÂä†</option>
                </select>
                <span id="storeStatus" style="color: #28a745; font-size: 14px;"></span>
            </div>
        </div>
        
        <!-- ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ -->
        <div id="successMessage" class="success-message">
            ‚úÖ Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ
        </div>
        
        <!-- Â∏≠ÈÖçÁΩÆË®≠ÂÆö -->
        <div class="config-panel">
            <h2>Â∏≠ÈÖçÁΩÆË®≠ÂÆö</h2>
            
            <!-- „Ç´„Ç¶„É≥„Çø„ÉºÂ∏≠ -->
            <div class="seat-section">
                <h3>ü™ë „Ç´„Ç¶„É≥„Çø„ÉºÂ∏≠</h3>
                <div id="counterSeats" class="seat-list">
                    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>Â∏≠Áï™Âè∑</label>
                        <input type="text" id="counterSeatId" placeholder="‰æã: C1">
                    </div>
                    <div class="form-group">
                        <label>ÂÆöÂì°</label>
                        <select id="counterCapacity">
                            <option value="1">1Âêç</option>
                            <option value="2">2Âêç</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('counter')">+ Â∏≠„ÇíËøΩÂä†</button>
                </div>
            </div>
            
            <!-- „ÉÜ„Éº„Éñ„É´Â∏≠ -->
            <div class="seat-section">
                <h3>üçΩÔ∏è „ÉÜ„Éº„Éñ„É´Â∏≠</h3>
                <div id="tableSeats" class="seat-list">
                    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>Â∏≠Áï™Âè∑</label>
                        <input type="text" id="tableSeatId" placeholder="‰æã: T1">
                    </div>
                    <div class="form-group">
                        <label>ÂÆöÂì°</label>
                        <select id="tableCapacity">
                            <option value="2">2Âêç</option>
                            <option value="4" selected>4Âêç</option>
                            <option value="6">6Âêç</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('table')">+ Â∏≠„ÇíËøΩÂä†</button>
                </div>
            </div>
            
            <!-- ÂÄãÂÆ§ -->
            <div class="seat-section">
                <h3>üö™ ÂÄãÂÆ§</h3>
                <div id="privateSeats" class="seat-list">
                    <!-- JavaScript„ÅßÂãïÁöÑÁîüÊàê -->
                </div>
                <div class="add-seat-form">
                    <div class="form-group">
                        <label>Â∏≠Áï™Âè∑</label>
                        <input type="text" id="privateSeatId" placeholder="‰æã: P1">
                    </div>
                    <div class="form-group">
                        <label>ÂÆöÂì°</label>
                        <select id="privateCapacity">
                            <option value="4">4Âêç</option>
                            <option value="6" selected>6Âêç</option>
                            <option value="8">8Âêç</option>
                            <option value="10">10Âêç</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="addSeat('private')">+ Â∏≠„ÇíËøΩÂä†</button>
                </div>
            </div>
            
            <!-- „Éó„É¨„Éì„É•„Éº -->
            <div class="preview-section">
                <h3>üìã „É¨„Ç§„Ç¢„Ç¶„Éà„Éó„É¨„Éì„É•„Éº</h3>
                <div class="seat-preview">
                    <div class="preview-row" id="previewCounter"></div>
                    <div class="preview-row" id="previewTable"></div>
                    <div class="preview-row" id="previewPrivate"></div>
                </div>
            </div>
            
            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
            <div class="actions-row">
                <button class="btn btn-success" onclick="saveLayout()">üíæ Ë®≠ÂÆö„Çí‰øùÂ≠ò</button>
                <button class="btn btn-secondary" onclick="resetLayout()">üîÑ „Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô</button>
                <button class="btn btn-danger" onclick="clearLayout()">üóëÔ∏è ÂÖ®Â∏≠ÂâäÈô§</button>
                <button class="btn btn-primary" onclick="window.location.href='/restaurant-admin.html'">üìä ÁÆ°ÁêÜÁîªÈù¢„Å∏</button>
            </div>
        </div>
    </div>
    
    <!-- Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Â∏≠„ÅÆÁ∑®ÈõÜ</h2>
            </div>
            <div class="form-group">
                <label>Â∏≠Áï™Âè∑</label>
                <input type="text" id="editSeatId">
            </div>
            <div class="form-group">
                <label>ÂÆöÂì°</label>
                <select id="editCapacity">
                    <option value="1">1Âêç</option>
                    <option value="2">2Âêç</option>
                    <option value="4">4Âêç</option>
                    <option value="6">6Âêç</option>
                    <option value="8">8Âêç</option>
                    <option value="10">10Âêç</option>
                </select>
            </div>
            <div class="actions-row">
                <button class="btn btn-primary" onclick="updateSeat()">Êõ¥Êñ∞</button>
                <button class="btn btn-secondary" onclick="closeEditModal()">„Ç≠„É£„É≥„Çª„É´</button>
            </div>
        </div>
    </div>
    
    <script>
        // ÁèæÂú®„ÅÆÂ∫óËàóID
        let currentStoreId = 'default';
        
        // Â∏≠„Éá„Éº„ÇøÔºàÂ∫óËàó„Åî„Å®„Å´ÁÆ°ÁêÜÔºâ
        let seatLayouts = {};
        
        // „Éá„Éï„Ç©„É´„Éà„É¨„Ç§„Ç¢„Ç¶„Éà
        const defaultLayout = {
            counter: [
                { id: 'C1', capacity: 1 },
                { id: 'C2', capacity: 1 },
                { id: 'C3', capacity: 1 },
                { id: 'C4', capacity: 1 }
            ],
            table: [
                { id: 'T1', capacity: 4 },
                { id: 'T2', capacity: 4 },
                { id: 'T3', capacity: 4 }
            ],
            private: [
                { id: 'P1', capacity: 6 },
                { id: 'P2', capacity: 8 }
            ]
        };
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            loadLayouts();
            loadStoreLayout();
        });
        
        // „É¨„Ç§„Ç¢„Ç¶„Éà„ÇíË™≠„ÅøËæº„Åø
        function loadLayouts() {
            const saved = localStorage.getItem('seatLayouts');
            if (saved) {
                seatLayouts = JSON.parse(saved);
            } else {
                seatLayouts = { default: defaultLayout };
            }
        }
        
        // Â∫óËàó„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíË™≠„ÅøËæº„Åø
        function loadStoreLayout() {
            const storeId = document.getElementById('storeSelect').value;
            
            if (storeId === 'new') {
                const newStoreName = prompt('Êñ∞„Åó„ÅÑÂ∫óËàóÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
                if (newStoreName) {
                    const newStoreId = 'store_' + Date.now();
                    const option = document.createElement('option');
                    option.value = newStoreId;
                    option.textContent = newStoreName;
                    
                    const select = document.getElementById('storeSelect');
                    select.insertBefore(option, select.lastElementChild);
                    select.value = newStoreId;
                    
                    currentStoreId = newStoreId;
                    seatLayouts[newStoreId] = JSON.parse(JSON.stringify(defaultLayout));
                } else {
                    document.getElementById('storeSelect').value = currentStoreId;
                    return;
                }
            } else {
                currentStoreId = storeId;
            }
            
            if (!seatLayouts[currentStoreId]) {
                seatLayouts[currentStoreId] = JSON.parse(JSON.stringify(defaultLayout));
            }
            
            renderSeats();
            updatePreview();
        }
        
        // Â∏≠„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderSeats() {
            const layout = seatLayouts[currentStoreId];
            
            // „Ç´„Ç¶„É≥„Çø„ÉºÂ∏≠
            renderSeatSection('counterSeats', layout.counter, 'counter');
            
            // „ÉÜ„Éº„Éñ„É´Â∏≠
            renderSeatSection('tableSeats', layout.table, 'table');
            
            // ÂÄãÂÆ§
            renderSeatSection('privateSeats', layout.private, 'private');
        }
        
        // Â∏≠„Çª„ÇØ„Ç∑„Éß„É≥„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderSeatSection(containerId, seats, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = seats.map(seat => `
                <div class="seat-item">
                    <div class="seat-info">
                        <span class="seat-id">${seat.id}</span>
                        <span class="seat-capacity">${seat.capacity}Âêç</span>
                    </div>
                    <div class="seat-actions">
                        <button class="btn-icon edit" onclick="editSeat('${type}', '${seat.id}')">‚úèÔ∏è</button>
                        <button class="btn-icon delete" onclick="deleteSeat('${type}', '${seat.id}')">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Â∏≠„ÇíËøΩÂä†
        function addSeat(type) {
            const idInput = document.getElementById(`${type}SeatId`);
            const capacityInput = document.getElementById(`${type}Capacity`);
            
            const seatId = idInput.value.trim().toUpperCase();
            const capacity = parseInt(capacityInput.value);
            
            if (!seatId) {
                alert('Â∏≠Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const layout = seatLayouts[currentStoreId];
            
            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            const exists = layout[type].some(s => s.id === seatId);
            if (exists) {
                alert('„Åì„ÅÆÂ∏≠Áï™Âè∑„ÅØÊó¢„Å´Â≠òÂú®„Åó„Åæ„Åô');
                return;
            }
            
            layout[type].push({ id: seatId, capacity: capacity });
            
            idInput.value = '';
            renderSeats();
            updatePreview();
        }
        
        // Â∏≠„ÇíÂâäÈô§
        function deleteSeat(type, seatId) {
            if (confirm(`Â∏≠ ${seatId} „ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                const layout = seatLayouts[currentStoreId];
                layout[type] = layout[type].filter(s => s.id !== seatId);
                renderSeats();
                updatePreview();
            }
        }
        
        // Â∏≠„ÇíÁ∑®ÈõÜ
        let editingType = null;
        let editingId = null;
        
        function editSeat(type, seatId) {
            const layout = seatLayouts[currentStoreId];
            const seat = layout[type].find(s => s.id === seatId);
            
            if (seat) {
                editingType = type;
                editingId = seatId;
                
                document.getElementById('editSeatId').value = seat.id;
                document.getElementById('editCapacity').value = seat.capacity;
                document.getElementById('editModal').classList.add('show');
            }
        }
        
        // Â∏≠„ÇíÊõ¥Êñ∞
        function updateSeat() {
            const newId = document.getElementById('editSeatId').value.trim().toUpperCase();
            const newCapacity = parseInt(document.getElementById('editCapacity').value);
            
            if (!newId) {
                alert('Â∏≠Áï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const layout = seatLayouts[currentStoreId];
            const seat = layout[editingType].find(s => s.id === editingId);
            
            if (seat) {
                seat.id = newId;
                seat.capacity = newCapacity;
                renderSeats();
                updatePreview();
                closeEditModal();
            }
        }
        
        // Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editingType = null;
            editingId = null;
        }
        
        // „Éó„É¨„Éì„É•„Éº„ÇíÊõ¥Êñ∞
        function updatePreview() {
            const layout = seatLayouts[currentStoreId];
            
            // „Ç´„Ç¶„É≥„Çø„ÉºÂ∏≠
            document.getElementById('previewCounter').innerHTML = layout.counter.map(seat => `
                <div class="preview-seat">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}Âêç</div>
                </div>
            `).join('');
            
            // „ÉÜ„Éº„Éñ„É´Â∏≠
            document.getElementById('previewTable').innerHTML = layout.table.map(seat => `
                <div class="preview-seat" style="border-color: #007bff;">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}Âêç</div>
                </div>
            `).join('');
            
            // ÂÄãÂÆ§
            document.getElementById('previewPrivate').innerHTML = layout.private.map(seat => `
                <div class="preview-seat" style="border-color: #dc3545;">
                    <div>${seat.id}</div>
                    <div style="font-size: 10px;">${seat.capacity}Âêç</div>
                </div>
            `).join('');
        }
        
        // „É¨„Ç§„Ç¢„Ç¶„Éà„Çí‰øùÂ≠ò
        function saveLayout() {
            localStorage.setItem('seatLayouts', JSON.stringify(seatLayouts));
            
            // „Çµ„Éº„Éê„Éº„Å´„ÇÇ‰øùÂ≠ò
            fetch('/api/seat-layout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    storeId: currentStoreId,
                    layout: seatLayouts[currentStoreId]
                })
            }).then(() => {
                // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫
                const message = document.getElementById('successMessage');
                message.classList.add('show');
                setTimeout(() => {
                    message.classList.remove('show');
                }, 3000);
                
                document.getElementById('storeStatus').textContent = '‚úÖ ‰øùÂ≠òÊ∏à„Åø';
            }).catch(err => {
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', err);
                alert('‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            });
        }
        
        // „Éá„Éï„Ç©„É´„Éà„Å´Êàª„Åô
        function resetLayout() {
            if (confirm('„Éá„Éï„Ç©„É´„Éà„ÅÆÂ∏≠ÈÖçÁΩÆ„Å´Êàª„Åó„Åæ„Åô„ÅãÔºü')) {
                seatLayouts[currentStoreId] = JSON.parse(JSON.stringify(defaultLayout));
                renderSeats();
                updatePreview();
            }
        }
        
        // ÂÖ®Â∏≠ÂâäÈô§
        function clearLayout() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆÂ∏≠„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                seatLayouts[currentStoreId] = {
                    counter: [],
                    table: [],
                    private: []
                };
                renderSeats();
                updatePreview();
            }
        }
    </script>
</body>
</html>