<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚·ã‚¹ãƒ†ãƒ  - å®Œå…¨ç‰ˆ</title>
</head>
<body>
<h1>çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…ã‚³ãƒ¼ãƒ‰</h1>
<p>ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’ admin-full-featured.html ã®æ—¢å­˜ãƒ‘ãƒƒãƒéƒ¨åˆ†ã¨ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚</p>

<hr>

<!-- ==================== çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚·ã‚¹ãƒ†ãƒ  ==================== -->
<h2>å®Œå…¨ãªçµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚·ã‚¹ãƒ†ãƒ </h2>
<pre><code>
<!-- 1. æœ€å°é™ã®äºˆé˜²CSSï¼ˆ</head>ã®ç›´å‰ï¼‰ -->
<style id="unified-sidebar-css">
/* æ—§ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¦ç´ ã®å®Œå…¨éè¡¨ç¤ºï¼ˆäºˆé˜²æªç½®ï¼‰ */
[data-legacy-menu],
[data-legacy-menu-target],
.old-sidebar,
.sidebar-menu:not(.c-sidebar__menu),
.menu-renderer {
    display: none !important;
    visibility: hidden !important;
    position: absolute !important;
    left: -9999px !important;
}

/* çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã¿æœ‰åŠ¹ */
#sidebar.c-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 300px;
    height: 100vh;
    background: #ffffff;
    box-shadow: 2px 0 12px rgba(0,0,0,0.15);
    z-index: 999999;
    transform: translateX(-100%);
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.3s ease,
                visibility 0.3s ease;
    overflow-y: auto;
    display: block !important; /* å¸¸ã«block */
}

#sidebar.c-sidebar.is-open {
    transform: translateX(0);
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
}

/* çµ±ä¸€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
#pageOverlay.c-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
    z-index: 999998;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    display: block !important;
}

#pageOverlay.c-overlay.is-visible {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
}

/* çµ±ä¸€ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ */
#unifiedHamburger {
    position: fixed;
    top: 15px;
    left: 15px;
    width: 48px;
    height: 48px;
    background: #ffffff;
    border: none;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    cursor: pointer;
    z-index: 10001;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

#unifiedHamburger:hover {
    background: #f5f5f5;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transform: scale(1.05);
}

/* ã‚µã‚¤ãƒ‰ãƒãƒ¼å†…éƒ¨ã‚¹ã‚¿ã‚¤ãƒ« */
.c-sidebar__header {
    padding: 20px;
    border-bottom: 1px solid #e0e0e0;
    background: #f8f9fa;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.c-sidebar__title {
    font-size: 18px;
    font-weight: 600;
    margin: 0;
}

.c-sidebar__close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    padding: 4px 8px;
    color: #666;
}

.c-sidebar__close:hover {
    color: #333;
}

.c-sidebar__content {
    padding: 20px;
}

.c-sidebar__menu {
    list-style: none;
    padding: 0;
    margin: 0;
}

.c-sidebar__menu-item {
    margin-bottom: 4px;
}

.c-sidebar__menu-link {
    display: block;
    padding: 12px 16px;
    color: #333;
    text-decoration: none;
    border-radius: 8px;
    transition: background 0.2s;
}

.c-sidebar__menu-link:hover {
    background: #f0f0f0;
}

.c-sidebar__menu-link.active {
    background: #e8f4f8;
    color: #0066cc;
    font-weight: 500;
}

/* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
#sidebar.c-sidebar::-webkit-scrollbar {
    width: 6px;
}

#sidebar.c-sidebar::-webkit-scrollbar-track {
    background: transparent;
}

#sidebar.c-sidebar::-webkit-scrollbar-thumb {
    background: #d0d0d0;
    border-radius: 3px;
}

/* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
@media (max-width: 768px) {
    #sidebar.c-sidebar {
        width: 85%;
        max-width: 300px;
    }
    
    #unifiedHamburger {
        top: 10px;
        left: 10px;
        width: 44px;
        height: 44px;
    }
}
</style>

<!-- 2. çµ±ä¸€ã‚µã‚¤ãƒ‰ãƒãƒ¼åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ</body>ã®ç›´å‰ï¼‰ -->
<script id="unified-sidebar-controller">
(function() {
    'use strict';
    
    // åˆæœŸåŒ–æ¸ˆã¿ãƒã‚§ãƒƒã‚¯
    if (window.__unifiedSidebarInitialized) {
        console.log('[UnifiedSidebar] Already initialized');
        return;
    }
    window.__unifiedSidebarInitialized = true;
    
    // ==================== DOMæ§‹é€ ã®ç¢ºç«‹ ====================
    function ensureUnifiedStructure() {
        // æ—§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å®Œå…¨å‰Šé™¤
        const legacySelectors = [
            '[data-legacy-menu]',
            '[data-legacy-menu-target]',
            '.old-sidebar',
            '.sidebar-menu:not(.c-sidebar__menu)',
            '.menu-renderer',
            '#sidebar:not(.c-sidebar)'
        ];
        
        legacySelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(el => {
                console.warn('[UnifiedSidebar] Removing legacy element:', el);
                el.remove();
            });
        });
        
        // æ­£ã—ã„ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ç¢ºä¿
        let sidebar = document.getElementById('sidebar');
        if (!sidebar || !sidebar.classList.contains('c-sidebar')) {
            if (sidebar) sidebar.remove();
            
            sidebar = document.createElement('aside');
            sidebar.id = 'sidebar';
            sidebar.className = 'c-sidebar';
            sidebar.setAttribute('aria-hidden', 'true');
            sidebar.setAttribute('role', 'navigation');
            sidebar.innerHTML = `
                <div class="c-sidebar__header">
                    <h2 class="c-sidebar__title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h2>
                    <button class="c-sidebar__close" aria-label="é–‰ã˜ã‚‹">Ã—</button>
                </div>
                <div class="c-sidebar__content">
                    <nav class="c-sidebar__nav">
                        <ul class="c-sidebar__menu">
                            <li class="c-sidebar__menu-item">
                                <a href="#" class="c-sidebar__menu-link active" data-action="calendar">
                                    ğŸ“… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
                                </a>
                            </li>
                            <li class="c-sidebar__menu-item">
                                <a href="#" class="c-sidebar__menu-link" data-action="reservations">
                                    ğŸ“‹ äºˆç´„ä¸€è¦§
                                </a>
                            </li>
                            <li class="c-sidebar__menu-item">
                                <a href="#" class="c-sidebar__menu-link" data-action="capacity">
                                    âš™ï¸ äºˆç´„æ ç®¡ç†
                                </a>
                            </li>
                            <li class="c-sidebar__menu-item">
                                <a href="#" class="c-sidebar__menu-link" data-action="notifications">
                                    ğŸ”” é€šçŸ¥ã‚»ãƒ³ã‚¿ãƒ¼
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            `;
            document.body.appendChild(sidebar);
        }
        
        // bodyç›´ä¸‹ã«ç§»å‹•
        if (sidebar.parentElement !== document.body) {
            document.body.appendChild(sidebar);
        }
        
        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ç¢ºä¿
        let overlay = document.getElementById('pageOverlay');
        if (!overlay || !overlay.classList.contains('c-overlay')) {
            if (overlay) overlay.remove();
            
            overlay = document.createElement('div');
            overlay.id = 'pageOverlay';
            overlay.className = 'c-overlay';
            overlay.setAttribute('aria-hidden', 'true');
            document.body.appendChild(overlay);
        }
        
        // çµ±ä¸€ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ã®ç¢ºä¿
        let hamburger = document.getElementById('unifiedHamburger');
        if (!hamburger) {
            // æ—¢å­˜ã®ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
            document.querySelectorAll('.c-hamburger, #c-hamburger-btn, .hamburger-button').forEach(el => {
                if (el.id !== 'unifiedHamburger') el.remove();
            });
            
            hamburger = document.createElement('button');
            hamburger.id = 'unifiedHamburger';
            hamburger.setAttribute('aria-label', 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼');
            hamburger.setAttribute('aria-controls', 'sidebar');
            hamburger.setAttribute('aria-expanded', 'false');
            hamburger.innerHTML = `
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            `;
            document.body.appendChild(hamburger);
        }
        
        return { sidebar, overlay, hamburger };
    }
    
    // ==================== çµ±ä¸€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ ====================
    class UnifiedSidebarController {
        constructor(elements) {
            this.sidebar = elements.sidebar;
            this.overlay = elements.overlay;
            this.hamburger = elements.hamburger;
            this.closeButton = this.sidebar.querySelector('.c-sidebar__close');
            this.isOpen = false;
            
            this.init();
        }
        
        init() {
            // åˆæœŸçŠ¶æ…‹ã‚’ç¢ºå®Ÿã«è¨­å®š
            this.close();
            
            // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®šï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
            this.hamburger.onclick = (e) => {
                e.preventDefault();
                e.stopPropagation();
                this.toggle();
            };
            
            if (this.closeButton) {
                this.closeButton.onclick = (e) => {
                    e.preventDefault();
                    this.close();
                };
            }
            
            this.overlay.onclick = () => this.close();
            
            // ESCã‚­ãƒ¼å¯¾å¿œ
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && this.isOpen) {
                    this.close();
                }
            });
            
            // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒªãƒ³ã‚¯
            this.sidebar.querySelectorAll('[data-action]').forEach(link => {
                link.onclick = (e) => {
                    e.preventDefault();
                    this.handleAction(link.dataset.action);
                    this.close();
                };
            });
            
            console.log('[UnifiedSidebar] Controller initialized');
        }
        
        toggle() {
            this.isOpen ? this.close() : this.open();
        }
        
        open() {
            if (this.isOpen) return;
            
            this.sidebar.classList.add('is-open');
            this.overlay.classList.add('is-visible');
            this.sidebar.setAttribute('aria-hidden', 'false');
            this.hamburger.setAttribute('aria-expanded', 'true');
            document.body.style.overflow = 'hidden';
            this.isOpen = true;
        }
        
        close() {
            this.sidebar.classList.remove('is-open');
            this.overlay.classList.remove('is-visible');
            this.sidebar.setAttribute('aria-hidden', 'true');
            this.hamburger.setAttribute('aria-expanded', 'false');
            document.body.style.overflow = '';
            this.isOpen = false;
        }
        
        handleAction(action) {
            // æ—¢å­˜ã®é–¢æ•°ã«ãƒãƒƒãƒ”ãƒ³ã‚°
            const actionMap = {
                'calendar': () => {
                    if (window.showCalendarView) window.showCalendarView();
                },
                'reservations': () => {
                    if (window.showReservationListView) window.showReservationListView();
                },
                'capacity': () => {
                    if (window.showCapacityControlsView) window.showCapacityControlsView();
                },
                'notifications': () => {
                    if (window.showNotificationView) window.showNotificationView();
                }
            };
            
            const handler = actionMap[action];
            if (handler) {
                handler();
            } else {
                console.log('[UnifiedSidebar] Unknown action:', action);
            }
        }
    }
    
    // ==================== åˆæœŸåŒ–å®Ÿè¡Œ ====================
    function initialize() {
        const elements = ensureUnifiedStructure();
        const controller = new UnifiedSidebarController(elements);
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹ï¼ˆäº’æ›æ€§ã®ãŸã‚ï¼‰
        window.unifiedSidebarController = controller;
        window.toggleSidebar = () => controller.toggle();
        window.openSidebar = () => controller.open();
        window.closeSidebar = () => controller.close();
        
        console.log('[UnifiedSidebar] System initialized');
    }
    
    // DOMèª­ã¿è¾¼ã¿å®Œäº†å¾Œã«å®Ÿè¡Œ
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initialize);
    } else {
        initialize();
    }
    
    // ==================== ç¶™ç¶šçš„ãªä¿è­· ====================
    const observer = new MutationObserver((mutations) => {
        mutations.forEach(mutation => {
            mutation.addedNodes.forEach(node => {
                if (node.nodeType === 1) {
                    // æ—§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¿½åŠ ã•ã‚ŒãŸã‚‰å³å‰Šé™¤
                    if (node.matches && (
                        node.matches('[data-legacy-menu]') ||
                        node.matches('.old-sidebar') ||
                        node.matches('.menu-renderer')
                    )) {
                        console.warn('[UnifiedSidebar] Blocked legacy menu:', node);
                        node.remove();
                    }
                }
            });
        });
    });
    
    observer.observe(document.body, {
        childList: true,
        subtree: true
    });
    
})();
</script>
</code></pre>

<hr>

<h2>é©ç”¨æ‰‹é †</h2>
<ol>
    <li><strong>æ—§ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤</strong>
        <ul>
            <li>1178-1229è¡Œã®æ—§ãƒ¡ãƒ‹ãƒ¥ãƒ¼HTMLè¦ç´ ã‚’å‰Šé™¤æ¸ˆã¿</li>
            <li>æ—¢å­˜ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼é–¢é€£ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å‰Šé™¤</li>
        </ul>
    </li>
    <li><strong>æ–°ã‚³ãƒ¼ãƒ‰ã®è¿½åŠ </strong>
        <ul>
            <li>ä¸Šè¨˜ã®CSSã‚’ &lt;/head&gt; ã®ç›´å‰ã«è¿½åŠ </li>
            <li>ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ &lt;/body&gt; ã®ç›´å‰ã«è¿½åŠ </li>
        </ul>
    </li>
    <li><strong>ç¢ºèª</strong>
        <ul>
            <li>ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã€ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ãƒœã‚¿ãƒ³ãŒ1ã¤ã ã‘è¡¨ç¤ºã•ã‚Œã‚‹</li>
            <li>ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒæ­£ã—ãé–‹é–‰ã™ã‚‹</li>
            <li>æ—§ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„</li>
        </ul>
    </li>
</ol>

<h2>ç¢ºèªç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰</h2>
<pre><code>
// 1. DOMæ§‹é€ ç¢ºèª
console.table({
    'Unified Sidebar': !!document.querySelector('#sidebar.c-sidebar'),
    'Unified Hamburger': !!document.getElementById('unifiedHamburger'),
    'Legacy Menus': document.querySelectorAll('[data-legacy-menu], .old-sidebar, .menu-renderer').length,
    'Total Sidebars': document.querySelectorAll('#sidebar').length
});

// 2. å‹•ä½œãƒ†ã‚¹ãƒˆ
window.unifiedSidebarController?.toggle();
</code></pre>

</body>
</html>