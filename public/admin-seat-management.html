<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â∫ßÂ∏≠ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</title>
    <!-- Admin Common CSS -->
    <link rel="stylesheet" href="/css/admin-common.css">
    <!-- Sidebar Menu CSS -->
    <link rel="stylesheet" href="/css/sidebar-menu.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f7;
            margin: 0;
            padding: 0;
        }
        
        /* „Ç≥„É≥„ÉÜ„É≥„ÉÑ„É©„ÉÉ„Éë„Éº */
        .content-wrapper {
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .date-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .date-input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .time-selector {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        @media (max-width: 968px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }
        
        .floor-map {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .floor-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
        }
        
        .seat-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            min-height: 400px;
            position: relative;
        }
        
        .seat {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border: 3px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .seat:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .seat.table {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .seat.counter {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 50%;
        }
        
        .seat.private_room {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: #333;
        }
        
        .seat.available {
            border-color: #4CAF50;
        }
        
        .seat.occupied {
            background: #ff6b6b !important;
            color: white;
            border-color: #ff5252;
        }
        
        .seat.reserved {
            background: #ffd54f !important;
            color: #333;
            border-color: #ffb300;
        }
        
        .seat-number {
            font-size: 18px;
            font-weight: bold;
        }
        
        .seat-capacity {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .seat-status {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }
        
        .reservation-list {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .reservation-item {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s;
        }
        
        .reservation-item:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .reservation-item.dragging {
            opacity: 0.5;
        }
        
        .reservation-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .reservation-name {
            font-weight: 600;
            color: #333;
        }
        
        .reservation-time {
            color: #666;
            font-size: 14px;
        }
        
        .reservation-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .seat-assignment {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #e0e0e0;
        }
        
        .assign-btn {
            padding: 6px 12px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .unassign-btn {
            padding: 6px 12px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }
        
        .modal-body {
            margin-bottom: 20px;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .legend {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .stats-panel {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .stat-item {
            text-align: center;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        
        .drop-zone {
            border: 3px dashed #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body>
    <div class="content-wrapper">
        <div class="header">
        <h1>ü™ë Â∫ßÂ∏≠ÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</h1>
        <div class="controls">
            <div class="date-selector">
                <label>Êó•‰ªò:</label>
                <input type="date" id="dateInput" class="date-input">
            </div>
            <div class="time-selector-wrapper">
                <label>ÊôÇÈñì:</label>
                <select id="timeSelect" class="time-selector">
                    <option value="18:00">18:00</option>
                    <option value="18:30">18:30</option>
                    <option value="19:00">19:00</option>
                    <option value="19:30">19:30</option>
                    <option value="20:00">20:00</option>
                    <option value="20:30">20:30</option>
                    <option value="21:00">21:00</option>
                </select>
            </div>
            <button class="btn" onclick="loadSeatStatus()">Êõ¥Êñ∞</button>
            <button class="btn" onclick="autoAssignSeats()" style="background: #4CAF50;">Ëá™ÂãïÂâ≤ÂΩì</button>
        </div>
    </div>
    
    <div class="stats-panel">
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="totalSeats">8</div>
                <div class="stat-label">Á∑èÂ∫ßÂ∏≠Êï∞</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="availableSeats">8</div>
                <div class="stat-label">Á©∫Â∏≠</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="occupiedSeats">0</div>
                <div class="stat-label">‰ΩøÁî®‰∏≠</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="reservationCount">0</div>
                <div class="stat-label">‰∫àÁ¥ÑÊï∞</div>
            </div>
        </div>
    </div>
    
    <div class="main-container">
        <div class="floor-map">
            <div class="floor-title">„Éï„É≠„Ç¢„Éû„ÉÉ„Éó</div>
            <div class="seat-grid" id="seatGrid">
                <!-- Â∫ßÂ∏≠„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #4CAF50;"></div>
                    <span>Á©∫Â∏≠</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ffd54f;"></div>
                    <span>‰∫àÁ¥ÑÊ∏à</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #ff6b6b;"></div>
                    <span>‰ΩøÁî®‰∏≠</span>
                </div>
            </div>
        </div>
        
        <div class="reservation-list">
            <h3 style="margin-bottom: 15px;">‰∫àÁ¥Ñ‰∏ÄË¶ßÔºà„Éâ„É©„ÉÉ„Ç∞„ÅßÂ∫ßÂ∏≠Ââ≤ÂΩìÔºâ</h3>
            <div id="reservationList">
                <!-- ‰∫àÁ¥Ñ„ÅåÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
            </div>
        </div>
    </div>
    
    <!-- Â∫ßÂ∏≠Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="seatModal">
        <div class="modal-content">
            <div class="modal-title">Â∫ßÂ∏≠Ë©≥Á¥∞</div>
            <div class="modal-body" id="seatModalBody">
                <!-- Ë©≥Á¥∞ÊÉÖÂ†± -->
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeSeatModal()">Èñâ„Åò„Çã</button>
                <button class="btn" onclick="saveS eatAssignment()" style="background: #4CAF50;">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let seats = [];
        let reservations = [];
        let currentDate = null;
        let currentTime = null;
        let draggedReservation = null;
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            initializeDateTimeSelectors();
            initializeSeats();
            loadSeatStatus();
        });
        
        // Êó•‰ªò„Å®ÊôÇÈñì„ÅÆÂàùÊúüÂåñ
        function initializeDateTimeSelectors() {
            const today = new Date();
            currentDate = formatDate(today);
            document.getElementById('dateInput').value = currentDate;
            
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // ÁèæÂú®ÊôÇÂàª„Å´ÊúÄ„ÇÇËøë„ÅÑÊôÇÈñìÊû†„ÇíÈÅ∏Êäû
            const timeSlots = ['18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00'];
            let selectedTime = timeSlots[0];
            
            for (const slot of timeSlots) {
                const [hour, minute] = slot.split(':').map(Number);
                if (hour > currentHour || (hour === currentHour && minute >= currentMinute)) {
                    selectedTime = slot;
                    break;
                }
            }
            
            document.getElementById('timeSelect').value = selectedTime;
            currentTime = selectedTime;
        }
        
        // Â∫ßÂ∏≠„ÅÆÂàùÊúüÂåñ
        function initializeSeats() {
            // „Éá„Éï„Ç©„É´„Éà„ÅÆÂ∫ßÂ∏≠ÈÖçÁΩÆ
            seats = [
                { id: 'T1', type: 'table', capacity: 4, x: 0, y: 0 },
                { id: 'T2', type: 'table', capacity: 4, x: 1, y: 0 },
                { id: 'T3', type: 'table', capacity: 2, x: 2, y: 0 },
                { id: 'T4', type: 'table', capacity: 2, x: 3, y: 0 },
                { id: 'C1', type: 'counter', capacity: 1, x: 0, y: 1 },
                { id: 'C2', type: 'counter', capacity: 1, x: 1, y: 1 },
                { id: 'C3', type: 'counter', capacity: 1, x: 2, y: 1 },
                { id: 'P1', type: 'private_room', capacity: 6, x: 4, y: 0 }
            ];
            
            renderSeats();
        }
        
        // Â∫ßÂ∏≠„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderSeats() {
            const grid = document.getElementById('seatGrid');
            grid.innerHTML = '';
            
            seats.forEach(seat => {
                const seatEl = document.createElement('div');
                seatEl.className = `seat ${seat.type} ${seat.status || 'available'}`;
                seatEl.id = `seat-${seat.id}`;
                seatEl.draggable = false;
                
                // „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥„Å®„Åó„Å¶Ë®≠ÂÆö
                seatEl.ondragover = (e) => {
                    e.preventDefault();
                    seatEl.classList.add('drop-zone');
                };
                
                seatEl.ondragleave = () => {
                    seatEl.classList.remove('drop-zone');
                };
                
                seatEl.ondrop = (e) => {
                    e.preventDefault();
                    seatEl.classList.remove('drop-zone');
                    if (draggedReservation) {
                        assignSeatToReservation(draggedReservation, seat.id);
                    }
                };
                
                seatEl.onclick = () => showSeatDetails(seat);
                
                // Â∫ßÂ∏≠ÊÉÖÂ†±„ÇíË°®Á§∫
                seatEl.innerHTML = `
                    <div class="seat-number">${seat.id}</div>
                    <div class="seat-capacity">${seat.capacity}Âêç</div>
                    ${seat.reservation ? `<div class="seat-status">${seat.reservation.customer_name}</div>` : ''}
                `;
                
                // „Ç∞„É™„ÉÉ„Éâ‰ΩçÁΩÆ„ÇíË®≠ÂÆö
                if (seat.x !== undefined && seat.y !== undefined) {
                    seatEl.style.gridColumn = seat.x + 1;
                    seatEl.style.gridRow = seat.y + 1;
                }
                
                grid.appendChild(seatEl);
            });
            
            updateStats();
        }
        
        // Â∫ßÂ∏≠Áä∂Ê≥Å„ÇíË™≠„ÅøËæº„Åø
        async function loadSeatStatus() {
            currentDate = document.getElementById('dateInput').value;
            currentTime = document.getElementById('timeSelect').value;
            
            try {
                // Â∫ßÂ∏≠Áä∂Ê≥Å„ÇíÂèñÂæó
                const ADMIN_API_KEY = (window.STORE_CONFIG && window.STORE_CONFIG.adminToken) || localStorage.getItem('ADMIN_API_KEY') || '';
                const authHeaders = ADMIN_API_KEY ? {
                    'x-api-key': ADMIN_API_KEY,
                    'Authorization': `Bearer ${ADMIN_API_KEY}`
                } : {};
                const seatResponse = await fetch(
                    `https://line-booking-api-116429620992.asia-northeast1.run.app/api/seat-availability?store_id=default-store&date=${currentDate}&time=${currentTime}`,
                    { headers: authHeaders }
                );
                const seatData = await seatResponse.json();
                
                // ‰∫àÁ¥Ñ‰∏ÄË¶ß„ÇíÂèñÂæó
                const reservationResponse = await fetch(
                    `https://line-booking-api-116429620992.asia-northeast1.run.app/api/reservations?store_id=default-store&date=${currentDate}`,
                    { headers: authHeaders }
                );
                const reservationData = await reservationResponse.json();
                
                // Â∫ßÂ∏≠Áä∂ÊÖã„ÇíÊõ¥Êñ∞
                if (Array.isArray(seatData)) {
                    seatData.forEach(seatInfo => {
                        const seat = seats.find(s => s.id === seatInfo.seat_number);
                        if (seat) {
                            seat.status = seatInfo.is_available ? 'available' : 'occupied';
                            seat.reservation = seatInfo.reservation_id ? {
                                id: seatInfo.reservation_id,
                                customer_name: seatInfo.reserved_by,
                                party_size: seatInfo.party_size
                            } : null;
                        }
                    });
                }
                
                // ‰∫àÁ¥Ñ‰∏ÄË¶ß„ÇíÊõ¥Êñ∞
                if (reservationData.reservations) {
                    reservations = reservationData.reservations.filter(r => 
                        r.time === currentTime && r.status !== 'cancelled'
                    );
                    renderReservations();
                }
                
                renderSeats();
                
            } catch (error) {
                console.error('Â∫ßÂ∏≠Áä∂Ê≥Å„ÅÆÂèñÂæó„Ç®„É©„Éº:', error);
                alert('Â∫ßÂ∏≠Áä∂Ê≥Å„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }
        
        // ‰∫àÁ¥Ñ‰∏ÄË¶ß„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderReservations() {
            const list = document.getElementById('reservationList');
            list.innerHTML = '';
            
            reservations.forEach(reservation => {
                const item = document.createElement('div');
                item.className = 'reservation-item';
                item.draggable = !reservation.seat_number; // Â∫ßÂ∏≠Êú™Ââ≤ÂΩì„ÅÆÂ†¥Âêà„ÅÆ„Åø„Éâ„É©„ÉÉ„Ç∞ÂèØËÉΩ
                
                item.ondragstart = (e) => {
                    draggedReservation = reservation;
                    item.classList.add('dragging');
                };
                
                item.ondragend = () => {
                    draggedReservation = null;
                    item.classList.remove('dragging');
                };
                
                item.innerHTML = `
                    <div class="reservation-header">
                        <div class="reservation-name">${reservation.customer_name}</div>
                        <div class="reservation-time">${reservation.time}</div>
                    </div>
                    <div class="reservation-details">
                        <div>üë• ${reservation.people}Âêç</div>
                        <div>üìû ${reservation.customer_phone}</div>
                    </div>
                    ${reservation.seat_number ? `
                        <div class="seat-assignment">
                            Â∫ßÂ∏≠: ${reservation.seat_number}
                            <button class="unassign-btn" onclick="unassignSeat('${reservation.id}')">Ëß£Èô§</button>
                        </div>
                    ` : `
                        <div class="seat-assignment">
                            <span style="color: #ff6b6b;">Â∫ßÂ∏≠Êú™Ââ≤ÂΩì</span>
                            <button class="assign-btn" onclick="showAssignModal('${reservation.id}')">Ââ≤ÂΩì</button>
                        </div>
                    `}
                `;
                
                list.appendChild(item);
            });
        }
        
        // Â∫ßÂ∏≠„Çí‰∫àÁ¥Ñ„Å´Ââ≤„ÇäÂΩì„Å¶
        async function assignSeatToReservation(reservation, seatId) {
            try {
                const response = await fetch('https://line-booking-api-116429620992.asia-northeast1.run.app/api/assign-seat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeaders
                    },
                    body: JSON.stringify({
                        reservation_id: reservation.id,
                        seat_number: seatId,
                        assigned_by: 'admin'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert(`Â∫ßÂ∏≠ ${seatId} „ÇíÂâ≤„ÇäÂΩì„Å¶„Åæ„Åó„Åü`);
                    loadSeatStatus();
                } else {
                    alert(result.message || 'Â∫ßÂ∏≠„ÅÆÂâ≤„ÇäÂΩì„Å¶„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                
            } catch (error) {
                console.error('Â∫ßÂ∏≠Ââ≤„ÇäÂΩì„Å¶„Ç®„É©„Éº:', error);
                alert('Â∫ßÂ∏≠„ÅÆÂâ≤„ÇäÂΩì„Å¶„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }
        
        // Â∫ßÂ∏≠Ââ≤„ÇäÂΩì„Å¶Ëß£Èô§
        async function unassignSeat(reservationId) {
            if (!confirm('Â∫ßÂ∏≠„ÅÆÂâ≤„ÇäÂΩì„Å¶„ÇíËß£Èô§„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }
            
            try {
                const response = await fetch('https://line-booking-api-116429620992.asia-northeast1.run.app/api/unassign-seat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        ...authHeaders
                    },
                    body: JSON.stringify({
                        reservation_id: reservationId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('Â∫ßÂ∏≠„ÅÆÂâ≤„ÇäÂΩì„Å¶„ÇíËß£Èô§„Åó„Åæ„Åó„Åü');
                    loadSeatStatus();
                } else {
                    alert(result.message || 'Â∫ßÂ∏≠„ÅÆËß£Èô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
                
            } catch (error) {
                console.error('Â∫ßÂ∏≠Ëß£Èô§„Ç®„É©„Éº:', error);
                alert('Â∫ßÂ∏≠„ÅÆËß£Èô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
            }
        }
        
        // Ëá™ÂãïÂ∫ßÂ∏≠Ââ≤„ÇäÂΩì„Å¶
        async function autoAssignSeats() {
            const unassignedReservations = reservations.filter(r => !r.seat_number);
            
            if (unassignedReservations.length === 0) {
                alert('Êú™Ââ≤ÂΩì„ÅÆ‰∫àÁ¥Ñ„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            const availableSeats = seats.filter(s => s.status === 'available');
            
            for (const reservation of unassignedReservations) {
                // ‰∫∫Êï∞„Å´Âêà„ÅÜÂ∫ßÂ∏≠„ÇíÊé¢„Åô
                const suitableSeat = availableSeats.find(s => 
                    s.capacity >= reservation.people && 
                    s.capacity <= reservation.people + 2 // Â§ß„Åç„Åô„Åé„ÇãÂ∫ßÂ∏≠„ÅØÈÅø„Åë„Çã
                );
                
                if (suitableSeat) {
                    await assignSeatToReservation(reservation, suitableSeat.id);
                    // ‰ΩøÁî®Ê∏à„Åø„Å®„Åó„Å¶„Éû„Éº„ÇØ
                    suitableSeat.status = 'occupied';
                }
            }
            
            alert('Ëá™ÂãïÂâ≤„ÇäÂΩì„Å¶„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
            loadSeatStatus();
        }
        
        // Â∫ßÂ∏≠Ë©≥Á¥∞„ÇíË°®Á§∫
        function showSeatDetails(seat) {
            const modal = document.getElementById('seatModal');
            const body = document.getElementById('seatModalBody');
            
            body.innerHTML = `
                <div style="margin-bottom: 15px;">
                    <strong>Â∫ßÂ∏≠Áï™Âè∑:</strong> ${seat.id}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>„Çø„Ç§„Éó:</strong> ${getSeatTypeName(seat.type)}
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>ÂÆöÂì°:</strong> ${seat.capacity}Âêç
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>Áä∂ÊÖã:</strong> ${getStatusName(seat.status)}
                </div>
                ${seat.reservation ? `
                    <div style="margin-bottom: 15px;">
                        <strong>‰∫àÁ¥ÑËÄÖ:</strong> ${seat.reservation.customer_name}
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>‰∫∫Êï∞:</strong> ${seat.reservation.party_size}Âêç
                    </div>
                ` : ''}
            `;
            
            modal.classList.add('show');
        }
        
        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeSeatModal() {
            document.getElementById('seatModal').classList.remove('show');
        }
        
        // Áµ±Ë®à„ÇíÊõ¥Êñ∞
        function updateStats() {
            const totalSeats = seats.length;
            const availableSeats = seats.filter(s => s.status === 'available').length;
            const occupiedSeats = seats.filter(s => s.status === 'occupied').length;
            const reservationCount = reservations.length;
            
            document.getElementById('totalSeats').textContent = totalSeats;
            document.getElementById('availableSeats').textContent = availableSeats;
            document.getElementById('occupiedSeats').textContent = occupiedSeats;
            document.getElementById('reservationCount').textContent = reservationCount;
        }
        
        // „Éò„É´„Éë„ÉºÈñ¢Êï∞
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function getSeatTypeName(type) {
            const types = {
                'table': '„ÉÜ„Éº„Éñ„É´',
                'counter': '„Ç´„Ç¶„É≥„Çø„Éº',
                'private_room': 'ÂÄãÂÆ§',
                'terrace': '„ÉÜ„É©„Çπ'
            };
            return types[type] || type;
        }
        
        function getStatusName(status) {
            const statuses = {
                'available': 'Á©∫Â∏≠',
                'occupied': '‰ΩøÁî®‰∏≠',
                'reserved': '‰∫àÁ¥ÑÊ∏à'
            };
            return statuses[status] || status;
        }
        
        // Ââ≤„ÇäÂΩì„Å¶„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        function showAssignModal(reservationId) {
            const reservation = reservations.find(r => r.id === reservationId);
            const availableSeats = seats.filter(s => 
                s.status === 'available' && s.capacity >= reservation.people
            );
            
            if (availableSeats.length === 0) {
                alert('Âà©Áî®ÂèØËÉΩ„Å™Â∫ßÂ∏≠„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Á∞°ÊòìÁöÑ„Å™Â∫ßÂ∏≠ÈÅ∏Êäû
            const seatOptions = availableSeats.map(s => 
                `${s.id} (${s.capacity}Âêç)`
            ).join('\n');
            
            const selectedSeat = prompt(`Â∫ßÂ∏≠„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ:\n${seatOptions}`);
            
            if (selectedSeat) {
                const seatId = selectedSeat.split(' ')[0];
                assignSeatToReservation(reservation, seatId);
            }
        }
    </script>
    </div><!-- content-wrapper ÁµÇ‰∫Ü -->
    <!-- ÂÖ±ÈÄö„Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„ÉºJS -->
    <script src='/js/sidebar-menu.js' defer></script>
</body>
</html>
