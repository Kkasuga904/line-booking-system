<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>席管理・割り当て | LINE予約システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.5;
        }
        
        /* ヘッダー */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 999;
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin: 0;
            text-align: center;
            flex: 1;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .page-title:hover {
            color: #4a90e2;
        }

        /* ハンバーガーメニュー */
        .hamburger-menu {
            position: relative;
            z-index: 1001;
        }

        .hamburger-icon {
            width: 30px;
            height: 24px;
            position: relative;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .hamburger-icon span {
            display: block;
            height: 3px;
            width: 100%;
            background: #333;
            border-radius: 3px;
            transition: 0.3s;
        }

        /* サイドバー */
        .sidebar {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.active {
            display: block;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-header h2 {
            font-size: 18px;
            margin: 0;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #666;
            text-decoration: none;
            transition: 0.3s;
        }

        .nav-item:hover {
            background: #f5f5f5;
            color: #4a90e2;
        }

        .nav-item.active {
            background: #e8f4fd;
            color: #4a90e2;
            border-left: 3px solid #4a90e2;
        }

        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
        }

        .nav-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            color: #555;
            text-decoration: none;
            font-size: 14px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }
        
        /* メインコンテンツ */
        .container {
            max-width: 1400px;
            margin: 80px auto 20px;
            padding: 0 20px;
        }
        
        /* 統計カード */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 600;
            color: #333;
        }
        
        .stat-change {
            font-size: 12px;
            margin-top: 8px;
            color: #666;
        }
        
        /* フロアマップ */
        .floor-map {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 30px;
        }
        
        .floor-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .floor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .seat {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .seat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .seat-number {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        .seat-capacity {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        
        .seat-status {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        /* 席の状態 */
        .seat.available {
            background: linear-gradient(135deg, #fff, #e8f8f0);
            border-color: #2ecc71;
        }
        
        .seat.available .seat-status {
            background: #2ecc71;
        }
        
        .seat.occupied {
            background: linear-gradient(135deg, #fff, #ffe8e8);
            border-color: #e74c3c;
        }
        
        .seat.occupied .seat-status {
            background: #e74c3c;
        }
        
        .seat.reserved {
            background: linear-gradient(135deg, #fff, #fff4e6);
            border-color: #f39c12;
        }
        
        .seat.reserved .seat-status {
            background: #f39c12;
        }
        
        .seat.cleaning {
            background: linear-gradient(135deg, #fff, #e6f4ff);
            border-color: #3498db;
        }
        
        .seat.cleaning .seat-status {
            background: #3498db;
        }
        
        /* 凡例 */
        .legend {
            display: flex;
            gap: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        /* 予約割り当てパネル */
        .assignment-panel {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        
        .reservation-list {
            margin-top: 20px;
        }
        
        .reservation-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .reservation-item:hover {
            background: #e8f0fe;
        }
        
        .reservation-info {
            flex: 1;
        }
        
        .customer-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .reservation-details {
            font-size: 14px;
            color: #666;
        }
        
        .assign-btn {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .assign-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .assign-btn.assigned {
            background: #2ecc71;
        }
        
        /* モーダル */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: #f5f5f7;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            background: white;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <div class="header">
        <div class="hamburger-menu" id="hamburgerMenu">
            <div class="hamburger-icon" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        <h1 class="page-title" onclick="window.location.href='/admin-full-featured.html'" style="cursor: pointer;">予約管理システム</h1>
    </div>

    <!-- サイドバー -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>📋 管理メニュー</h2>
        </div>
        <nav class="sidebar-nav">
            <div style="padding: 10px 20px; font-size: 12px; color: #999; text-transform: uppercase; letter-spacing: 1px;">メイン</div>
            <a href="/admin-full-featured.html" class="nav-item">
                <span class="nav-icon">📅</span>
                <span>カレンダー</span>
            </a>
            <a href="/admin-list.html" class="nav-item">
                <span class="nav-icon">📋</span>
                <span>予約一覧</span>
            </a>
            <a href="/admin-analytics.html" class="nav-item">
                <span class="nav-icon">📊</span>
                <span>統計・分析</span>
            </a>
            <div style="padding: 10px 20px; font-size: 12px; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px;">予約管理</div>
            <a href="/capacity-control-enhanced.html" class="nav-item">
                <span class="nav-icon">🎯</span>
                <span>予約制限設定</span>
            </a>
            <a href="/seats-management-enhanced.html" class="nav-item active">
                <span class="nav-icon">💺</span>
                <span>席管理・割り当て</span>
            </a>
            <a href="/admin-settings.html" class="nav-item">
                <span class="nav-icon">⏰</span>
                <span>営業時間設定</span>
            </a>
            <a href="/admin-templates.html" class="nav-item">
                <span class="nav-icon">📝</span>
                <span>テンプレート管理</span>
            </a>
            <a href="/admin-customers.html" class="nav-item">
                <span class="nav-icon">👥</span>
                <span>顧客管理</span>
            </a>
            <div style="padding: 10px 20px; font-size: 12px; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-top: 20px;">高度な機能</div>
            <a href="/admin-analytics.html" class="nav-item">
                <span class="nav-icon">📊</span>
                <span>詳細分析</span>
            </a>
            <a href="/admin-dashboard.html" class="nav-item">
                <span class="nav-icon">🎯</span>
                <span>ダッシュボード</span>
            </a>
            <a href="/admin-notifications.html" class="nav-item">
                <span class="nav-icon">🔔</span>
                <span>通知センター</span>
            </a>
            <a href="/admin-advanced.html" class="nav-item">
                <span class="nav-icon">⚙️</span>
                <span>詳細設定</span>
            </a>
        </nav>
    </div>
    
    <!-- メインコンテンツ -->
    <div class="container">
        <!-- 統計カード -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">総席数</div>
                <div class="stat-value">24</div>
                <div class="stat-change">テーブル: 6 / カウンター: 8 / 個室: 2</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">空席</div>
                <div class="stat-value" style="color: #2ecc71;">12</div>
                <div class="stat-change">50% 利用可能</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">使用中</div>
                <div class="stat-value" style="color: #e74c3c;">8</div>
                <div class="stat-change">33% 使用中</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">予約済み</div>
                <div class="stat-value" style="color: #f39c12;">3</div>
                <div class="stat-change">次の予約: 19:00</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">清掃中</div>
                <div class="stat-value" style="color: #3498db;">1</div>
                <div class="stat-change">約10分で利用可能</div>
            </div>
        </div>
        
        <!-- フロアマップ -->
        <div class="floor-map">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 class="floor-title">フロアマップ</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="nav-btn" onclick="openAddSeatModal()" style="background: #2ecc71; color: white; border: none;">
                        ➕ 席を追加
                    </button>
                    <button class="nav-btn" onclick="toggleDeleteMode()" style="background: #e74c3c; color: white; border: none;">
                        🗑️ 削除モード
                    </button>
                </div>
            </div>
            
            <!-- 凡例 -->
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;"></div>
                    <span>空席</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>使用中</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12;"></div>
                    <span>予約済み</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <span>清掃中</span>
                </div>
            </div>
            
            <!-- 席グリッド -->
            <div class="floor-grid" id="floorGrid">
                <!-- 席が動的に生成される -->
            </div>
        </div>
        
        <!-- 予約割り当てパネル -->
        <div class="assignment-panel">
            <h2 class="floor-title">本日の予約割り当て</h2>
            <div class="reservation-list" id="reservationList">
                <!-- 予約が動的に表示される -->
            </div>
        </div>
    </div>
    
    <!-- 席割り当てモーダル -->
    <div class="modal" id="assignModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">席の割り当て</h2>
                <button class="modal-close" onclick="closeModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">予約情報</label>
                <div id="modalReservationInfo" style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                    <!-- 予約情報が表示される -->
                </div>
            </div>
            <div class="form-group">
                <label class="form-label">割り当てる席</label>
                <select class="form-select" id="seatSelect">
                    <option value="">席を選択してください</option>
                </select>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal()">キャンセル</button>
                <button class="btn btn-primary" onclick="confirmAssignment()">割り当て</button>
            </div>
        </div>
    </div>

    <!-- 席追加モーダル -->
    <div class="modal" id="addSeatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">新しい席を追加</h2>
                <button class="modal-close" onclick="closeAddSeatModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">席番号</label>
                <input type="text" class="form-input" id="newSeatId" placeholder="例: D1, VIP3">
            </div>
            <div class="form-group">
                <label class="form-label">席タイプ</label>
                <select class="form-select" id="newSeatType">
                    <option value="table">テーブル</option>
                    <option value="counter">カウンター</option>
                    <option value="private">個室</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">収容人数</label>
                <input type="number" class="form-input" id="newSeatCapacity" min="1" max="20" value="4">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeAddSeatModal()">キャンセル</button>
                <button class="btn btn-primary" onclick="addNewSeat()">追加</button>
            </div>
        </div>
    </div>
    
    <script>
        // 席データ
        const seats = [
            { id: 'A1', type: 'table', capacity: 4, status: 'available' },
            { id: 'A2', type: 'table', capacity: 4, status: 'occupied', customer: '山田様' },
            { id: 'A3', type: 'table', capacity: 4, status: 'available' },
            { id: 'A4', type: 'table', capacity: 4, status: 'reserved', time: '19:00' },
            { id: 'B1', type: 'table', capacity: 2, status: 'available' },
            { id: 'B2', type: 'table', capacity: 2, status: 'occupied', customer: '佐藤様' },
            { id: 'B3', type: 'table', capacity: 2, status: 'cleaning' },
            { id: 'B4', type: 'table', capacity: 2, status: 'available' },
            { id: 'C1', type: 'counter', capacity: 1, status: 'available' },
            { id: 'C2', type: 'counter', capacity: 1, status: 'available' },
            { id: 'C3', type: 'counter', capacity: 1, status: 'occupied', customer: '鈴木様' },
            { id: 'C4', type: 'counter', capacity: 1, status: 'available' },
            { id: 'C5', type: 'counter', capacity: 1, status: 'available' },
            { id: 'C6', type: 'counter', capacity: 1, status: 'occupied', customer: '田中様' },
            { id: 'C7', type: 'counter', capacity: 1, status: 'available' },
            { id: 'C8', type: 'counter', capacity: 1, status: 'available' },
            { id: 'VIP1', type: 'private', capacity: 6, status: 'reserved', time: '20:00' },
            { id: 'VIP2', type: 'private', capacity: 8, status: 'occupied', customer: '高橋様' }
        ];
        
        // 予約データ
        const reservations = [
            { id: 1, customerName: '伊藤様', time: '18:00', numberOfPeople: 4, assigned: false },
            { id: 2, customerName: '渡辺様', time: '18:30', numberOfPeople: 2, assigned: 'B1' },
            { id: 3, customerName: '中村様', time: '19:00', numberOfPeople: 3, assigned: false },
            { id: 4, customerName: '小林様', time: '19:30', numberOfPeople: 6, assigned: false },
            { id: 5, customerName: '加藤様', time: '20:00', numberOfPeople: 2, assigned: false }
        ];
        
        let selectedReservation = null;
        
        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            loadSeatData();
            renderFloorMap();
            renderReservations();
            updateStats();
        });

        // ハンバーガーメニューのトグル
        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }

        // サイドバーを閉じる
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.remove('active');
        }
        
        // フロアマップ描画
        function renderFloorMap() {
            const grid = document.getElementById('floorGrid');
            grid.innerHTML = '';
            
            seats.forEach(seat => {
                const seatEl = document.createElement('div');
                seatEl.className = `seat ${seat.status}`;
                if (deleteMode) {
                    seatEl.style.cursor = 'pointer';
                    seatEl.style.border = '2px dashed #e74c3c';
                    seatEl.onclick = () => deleteSeat(seat.id);
                } else {
                    seatEl.onclick = () => handleSeatClick(seat);
                }
                
                let statusInfo = '';
                if (seat.status === 'occupied' && seat.customer) {
                    statusInfo = `<div style="font-size: 11px; margin-top: 4px;">${seat.customer}</div>`;
                } else if (seat.status === 'reserved' && seat.time) {
                    statusInfo = `<div style="font-size: 11px; margin-top: 4px;">${seat.time}〜</div>`;
                }
                
                seatEl.innerHTML = `
                    <div class="seat-status"></div>
                    <div class="seat-number">${seat.id}</div>
                    <div class="seat-capacity">${seat.capacity}名席</div>
                    ${statusInfo}
                    ${deleteMode ? '<div style="color: #e74c3c; font-size: 11px;">クリックで削除</div>' : ''}
                `;
                
                grid.appendChild(seatEl);
            });
        }
        
        // 予約リスト描画
        function renderReservations() {
            const list = document.getElementById('reservationList');
            list.innerHTML = '';
            
            const today = new Date().toLocaleDateString('ja-JP');
            
            reservations.forEach(reservation => {
                const item = document.createElement('div');
                item.className = 'reservation-item';
                
                const assignedSeat = reservation.assigned ? 
                    `<span style="color: #2ecc71;">✓ ${reservation.assigned}席</span>` : 
                    '<span style="color: #e74c3c;">未割り当て</span>';
                
                item.innerHTML = `
                    <div class="reservation-info">
                        <div class="customer-name">${reservation.customerName}</div>
                        <div class="reservation-details">
                            ${today} ${reservation.time} / ${reservation.numberOfPeople}名 / ${assignedSeat}
                        </div>
                    </div>
                    <button class="assign-btn ${reservation.assigned ? 'assigned' : ''}" 
                            onclick="openAssignModal(${reservation.id})">
                        ${reservation.assigned ? '変更' : '席を割り当て'}
                    </button>
                `;
                
                list.appendChild(item);
            });
        }
        
        // 統計更新
        function updateStats() {
            const total = seats.length;
            const available = seats.filter(s => s.status === 'available').length;
            const occupied = seats.filter(s => s.status === 'occupied').length;
            const reserved = seats.filter(s => s.status === 'reserved').length;
            const cleaning = seats.filter(s => s.status === 'cleaning').length;
            
            // 統計カードの値を更新（実際のDOMがあれば）
        }
        
        // 席クリック処理
        function handleSeatClick(seat) {
            if (seat.status === 'available') {
                // 空席の場合、状態変更メニューを表示
                const newStatus = prompt(`席 ${seat.id} の状態を変更:\n1: 使用中\n2: 清掃中\n3: 予約済み`);
                if (newStatus === '1') {
                    seat.status = 'occupied';
                    seat.customer = prompt('お客様名:') || '名前なし';
                } else if (newStatus === '2') {
                    seat.status = 'cleaning';
                } else if (newStatus === '3') {
                    seat.status = 'reserved';
                    seat.time = prompt('予約時間:') || '19:00';
                }
                renderFloorMap();
                updateStats();
            } else if (seat.status === 'occupied' || seat.status === 'cleaning') {
                // 使用中/清掃中の場合、空席に戻す
                if (confirm(`席 ${seat.id} を空席に戻しますか？`)) {
                    seat.status = 'available';
                    delete seat.customer;
                    delete seat.time;
                    renderFloorMap();
                    updateStats();
                }
            }
        }
        
        // 割り当てモーダルを開く
        function openAssignModal(reservationId) {
            selectedReservation = reservations.find(r => r.id === reservationId);
            if (!selectedReservation) return;
            
            const modal = document.getElementById('assignModal');
            const info = document.getElementById('modalReservationInfo');
            const select = document.getElementById('seatSelect');
            
            // 予約情報表示
            info.innerHTML = `
                <div><strong>${selectedReservation.customerName}</strong></div>
                <div>時間: ${selectedReservation.time}</div>
                <div>人数: ${selectedReservation.numberOfPeople}名</div>
                ${selectedReservation.assigned ? `<div>現在の席: ${selectedReservation.assigned}</div>` : ''}
            `;
            
            // 利用可能な席をリストアップ
            select.innerHTML = '<option value="">席を選択してください</option>';
            seats.filter(seat => 
                seat.status === 'available' && 
                seat.capacity >= selectedReservation.numberOfPeople
            ).forEach(seat => {
                const option = document.createElement('option');
                option.value = seat.id;
                option.textContent = `${seat.id} (${seat.capacity}名席)`;
                select.appendChild(option);
            });
            
            modal.classList.add('active');
        }
        
        // モーダルを閉じる
        function closeModal() {
            document.getElementById('assignModal').classList.remove('active');
            selectedReservation = null;
        }
        
        // 席割り当て確定
        function confirmAssignment() {
            const seatId = document.getElementById('seatSelect').value;
            if (!seatId || !selectedReservation) return;
            
            // 以前の席を解放
            if (selectedReservation.assigned) {
                const oldSeat = seats.find(s => s.id === selectedReservation.assigned);
                if (oldSeat) {
                    oldSeat.status = 'available';
                    delete oldSeat.customer;
                }
            }
            
            // 新しい席を予約
            const newSeat = seats.find(s => s.id === seatId);
            if (newSeat) {
                newSeat.status = 'reserved';
                newSeat.time = selectedReservation.time;
                selectedReservation.assigned = seatId;
            }
            
            renderFloorMap();
            renderReservations();
            updateStats();
            closeModal();
            
            // 通知
            showNotification(`${selectedReservation.customerName}を${seatId}席に割り当てました`);
        }
        
        // 通知表示
        function showNotification(message, type = 'success') {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? '#2ecc71' : type === 'error' ? '#e74c3c' : '#f39c12';
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 3000;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }

        // 削除モード
        let deleteMode = false;

        function toggleDeleteMode() {
            deleteMode = !deleteMode;
            const btn = event.target;
            if (deleteMode) {
                btn.style.background = '#c0392b';
                btn.textContent = '✖️ 削除モード終了';
                showNotification('削除したい席をクリックしてください', 'warning');
            } else {
                btn.style.background = '#e74c3c';
                btn.textContent = '🗑️ 削除モード';
            }
            renderFloorMap();
        }

        // 席を削除
        function deleteSeat(seatId) {
            if (!deleteMode) return;
            
            if (confirm(`席 ${seatId} を削除しますか？`)) {
                const index = seats.findIndex(s => s.id === seatId);
                if (index !== -1) {
                    seats.splice(index, 1);
                    renderFloorMap();
                    updateStats();
                    showNotification(`席 ${seatId} を削除しました`);
                    saveSeatData();
                }
            }
        }

        // 席追加モーダルを開く
        function openAddSeatModal() {
            document.getElementById('addSeatModal').classList.add('active');
        }

        // 席追加モーダルを閉じる
        function closeAddSeatModal() {
            document.getElementById('addSeatModal').classList.remove('active');
            document.getElementById('newSeatId').value = '';
            document.getElementById('newSeatCapacity').value = '4';
        }

        // 新しい席を追加
        function addNewSeat() {
            const seatId = document.getElementById('newSeatId').value.trim();
            const seatType = document.getElementById('newSeatType').value;
            const capacity = parseInt(document.getElementById('newSeatCapacity').value);

            if (!seatId) {
                showNotification('席番号を入力してください', 'error');
                return;
            }

            if (seats.find(s => s.id === seatId)) {
                showNotification('その席番号は既に存在します', 'error');
                return;
            }

            seats.push({
                id: seatId,
                type: seatType,
                capacity: capacity,
                status: 'available'
            });

            renderFloorMap();
            updateStats();
            closeAddSeatModal();
            showNotification(`席 ${seatId} を追加しました`);
            saveSeatData();
        }

        // 席データを保存
        function saveSeatData() {
            localStorage.setItem('seatData', JSON.stringify(seats));
        }

        // 席データを読み込み
        function loadSeatData() {
            const saved = localStorage.getItem('seatData');
            if (saved) {
                seats.length = 0;
                seats.push(...JSON.parse(saved));
            }
        }
    </script>
</body>
</html>