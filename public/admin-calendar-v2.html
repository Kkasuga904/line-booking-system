<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫àÁ¥ÑÁÆ°ÁêÜ„Ç´„É¨„É≥„ÉÄ„Éº | LINE‰∫àÁ¥Ñ„Ç∑„Çπ„ÉÜ„É†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
        }
        
        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .store-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .store-name {
            font-size: 18px;
            font-weight: 600;
        }
        
        .view-controls {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .calendar-nav {
            background: white;
            padding: 20px;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .nav-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .month-selector {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .nav-arrow {
            width: 36px;
            height: 36px;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .nav-arrow:hover {
            background: #f5f5f7;
        }
        
        .current-month {
            font-size: 24px;
            font-weight: 600;
            min-width: 200px;
            text-align: center;
        }
        
        .today-btn {
            padding: 8px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        /* „Éì„É•„ÉºÂàá„ÇäÊõø„Åà */
        .view-toggle {
            display: flex;
            gap: 5px;
            background: #f0f0f0;
            padding: 3px;
            border-radius: 8px;
        }
        
        .view-btn {
            padding: 6px 16px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #666;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .view-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .view-btn.active {
            background: white;
            color: #667eea;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* Áµ±Ë®à„Çµ„Éû„É™„Éº */
        .summary-bar {
            background: white;
            padding: 15px 20px;
            margin: 20px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .summary-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 600;
        }
        
        /* „Ç´„É¨„É≥„ÉÄ„Éº„ÉÜ„Éº„Éñ„É´ */
        .calendar-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px 20px;
        }
        
        .calendar-table-wrapper {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .calendar-table thead {
            background: #f8f9fa;
        }
        
        .calendar-table th {
            padding: 15px 10px;
            border: 1px solid #e0e0e0;
            text-align: center;
            font-weight: 600;
        }
        
        .calendar-table th:first-child {
            width: 80px;
            background: #f8f9fa;
        }
        
        .day-header {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .day-date {
            font-size: 20px;
            font-weight: 600;
        }
        
        th.today {
            background: #667eea;
            color: white;
        }
        
        th.today .day-header {
            color: rgba(255,255,255,0.9);
        }
        
        .calendar-table tbody td {
            border: 1px solid #e0e0e0;
            height: 60px;
            position: relative;
            vertical-align: top;
            padding: 2px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .calendar-table tbody td:hover:not(:first-child) {
            background: rgba(102, 126, 234, 0.05);
        }
        
        .calendar-table tbody td:first-child {
            background: #fafafa;
            text-align: center;
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }
        
        /* ‰∫àÁ¥Ñ„Ç´„Éº„Éâ */
        .reservation-card {
            position: relative;
            padding: 6px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            z-index: 5;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-bottom: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .reservation-card:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            z-index: 15;
        }
        
        /* ÂêåÊôÇÂàª„ÅÆ‰∫àÁ¥Ñ„Ç≥„É≥„ÉÜ„Éä */
        .time-slot-reservations {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding: 2px;
            min-height: 56px;
        }
        
        /* ‰∫àÁ¥Ñ„ÅåÂ§ö„ÅÑÂ†¥Âêà„ÅÆ„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº */
        .more-reservations {
            background: #666;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            text-align: center;
            cursor: pointer;
        }
        
        .reservation-card.pending {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .reservation-card.confirmed {
            background: linear-gradient(135deg, #06c755, #00b74a);
            color: white;
        }
        
        .reservation-card.cancelled {
            background: linear-gradient(135deg, #ef5350, #e91e63);
            color: white;
            opacity: 0.7;
        }
        
        .card-content {
            flex: 1;
        }
        
        .card-time {
            font-weight: 600;
            font-size: 10px;
        }
        
        .card-name {
            font-size: 10px;
            margin-top: 1px;
        }
        
        .card-people {
            font-size: 9px;
            opacity: 0.9;
        }
        
        .card-seat {
            font-size: 10px;
            color: #fff;
            font-weight: 500;
            margin-top: 2px;
            opacity: 0.95;
        }
        
        .mobile-reservation-seat {
            font-size: 11px;
            color: #667eea;
            font-weight: 500;
            margin-top: 3px;
        }
        
        /* „Çπ„ÇØ„É≠„Éº„É´„Éê„ÉºË™øÊï¥ */
        .calendar-scroll-wrapper {
            max-height: 600px;
            overflow: auto;
            position: relative;
        }
        
        /* „É¢„Éº„ÉÄ„É´ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 16px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 20px;
        }
        
        .detail-row {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .detail-label {
            flex: 0 0 100px;
            color: #666;
            font-size: 14px;
        }
        
        .detail-value {
            flex: 1;
            font-size: 14px;
        }
        
        .modal-close {
            margin-top: 20px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        
        .modal-delete {
            margin-top: 10px;
            padding: 10px 20px;
            background: #ef5350;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }
        
        .modal-delete:hover {
            background: #e53935;
        }
        
        /* ‰∫àÁ¥ÑËøΩÂä†„Éï„Ç©„Éº„É† */
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .form-submit {
            margin-top: 20px;
            padding: 12px 24px;
            background: #06c755;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-size: 14px;
            font-weight: 500;
        }
        
        .form-submit:hover {
            background: #00b74a;
        }
        
        /* „É¢„Éê„Ç§„É´Áî®„É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 768px) {
            /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ë™øÊï¥ */
            .calendar-nav {
                margin: 10px;
                padding: 15px;
            }
            
            .current-month {
                font-size: 18px;
                min-width: auto;
            }
            
            .summary-bar {
                margin: 10px;
                padding: 10px;
            }
            
            .summary-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .summary-value {
                font-size: 18px;
            }
            
            /* „ÉÜ„Éº„Éñ„É´ÂÖ®‰Ωì„Çí„É™„Çπ„ÉàÂΩ¢Âºè„Å´Â§âÊõ¥ */
            .calendar-table-wrapper {
                display: none;
            }
            
            /* „É¢„Éê„Ç§„É´Áî®„É™„Çπ„Éà„Éì„É•„Éº */
            .mobile-calendar-view {
                display: block;
                background: white;
                border-radius: 12px;
                padding: 10px;
                margin: 10px;
            }
            
            .mobile-day-section {
                margin-bottom: 20px;
                border-bottom: 1px solid #e0e0e0;
                padding-bottom: 15px;
            }
            
            .mobile-day-header {
                font-size: 16px;
                font-weight: 600;
                margin-bottom: 10px;
                padding: 10px;
                background: #f8f9fa;
                border-radius: 8px;
            }
            
            .mobile-day-header.today {
                background: #667eea;
                color: white;
            }
            
            .mobile-reservation-card {
                background: white;
                border: 1px solid #e0e0e0;
                border-radius: 8px;
                padding: 12px;
                margin-bottom: 8px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            }
            
            .mobile-reservation-card.pending {
                border-left: 4px solid #667eea;
            }
            
            .mobile-reservation-card.confirmed {
                border-left: 4px solid #06c755;
            }
            
            .mobile-reservation-card.cancelled {
                border-left: 4px solid #ef5350;
                opacity: 0.7;
            }
            
            .mobile-reservation-time {
                font-size: 16px;
                font-weight: 600;
                color: #1d1d1f;
                margin-bottom: 4px;
            }
            
            .mobile-reservation-name {
                font-size: 14px;
                color: #333;
                margin-bottom: 2px;
            }
            
            .mobile-reservation-people {
                font-size: 12px;
                color: #666;
            }
            
            .mobile-empty-message {
                text-align: center;
                color: #999;
                padding: 20px;
                font-size: 14px;
            }
        }
        
        /* PC„Åß„É¢„Éê„Ç§„É´„Éì„É•„Éº„ÇíÈùûË°®Á§∫ */
        @media (min-width: 769px) {
            .mobile-calendar-view {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="header">
        <div class="header-content">
            <div class="store-info">
                <span class="store-name">‰∫àÁ¥ÑÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†</span>
                <span style="color: #666; font-size: 14px;">„Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº</span>
            </div>
            <div class="view-controls">
                <button class="view-btn active">ÈÄ±Ë°®Á§∫</button>
                <button class="view-btn" onclick="alert('Êó•Ë°®Á§∫„ÅØÊ∫ñÂÇô‰∏≠„Åß„Åô')">Êó•Ë°®Á§∫</button>
                <button class="view-btn" onclick="window.location.href='/admin'">üìã „É™„Çπ„ÉàË°®Á§∫</button>
            </div>
        </div>
    </header>
    
    <!-- „Ç´„É¨„É≥„ÉÄ„Éº„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <div class="calendar-nav">
        <div class="nav-content">
            <div class="view-toggle">
                <button class="view-btn active" id="weekViewBtn" onclick="setViewMode('week')">ÈÄ±</button>
                <button class="view-btn" id="dayViewBtn" onclick="setViewMode('day')">Êó•</button>
            </div>
            <div class="month-selector">
                <button class="nav-arrow" onclick="navigate(-1)">‚Üê</button>
                <div class="current-month" id="currentPeriod">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
                <button class="nav-arrow" onclick="navigate(1)">‚Üí</button>
            </div>
            <button class="today-btn" onclick="goToToday()">‰ªäÊó•</button>
        </div>
    </div>
    
    <!-- Áµ±Ë®à„Çµ„Éû„É™„Éº -->
    <div class="summary-bar">
        <div class="summary-content">
            <div class="summary-item">
                <div class="summary-label">Êú¨Êó•„ÅÆ‰∫àÁ¥Ñ</div>
                <div class="summary-value" id="todayCount">0</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">‰ªäÈÄ±„ÅÆ‰∫àÁ¥Ñ</div>
                <div class="summary-value" id="weekCount">0</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">‰∫àÁ¥ÑÁéá</div>
                <div class="summary-value" id="occupancyRate">0%</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Âπ≥Âùá‰∫∫Êï∞</div>
                <div class="summary-value" id="avgPeople">0Âêç</div>
            </div>
        </div>
    </div>
    
    <!-- „Ç´„É¨„É≥„ÉÄ„Éº„ÉÜ„Éº„Éñ„É´ÔºàPCÁî®Ôºâ -->
    <div class="calendar-container">
        <div class="calendar-table-wrapper">
            <div class="calendar-scroll-wrapper">
                <table class="calendar-table">
                    <thead id="calendarHeader">
                        <!-- „Éò„ÉÉ„ÉÄ„Éº„ÅØÂãïÁöÑÁîüÊàê -->
                    </thead>
                    <tbody id="calendarBody">
                        <!-- „Éú„Éá„Ç£„ÅØÂãïÁöÑÁîüÊàê -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- „É¢„Éê„Ç§„É´Áî®„Ç´„É¨„É≥„ÉÄ„Éº„Éì„É•„Éº -->
        <div class="mobile-calendar-view" id="mobileCalendarView">
            <!-- „É¢„Éê„Ç§„É´Áî®„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅØÂãïÁöÑÁîüÊàê -->
        </div>
    </div>
    
    <!-- Ë©≥Á¥∞„É¢„Éº„ÉÄ„É´ -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">‰∫àÁ¥ÑË©≥Á¥∞</div>
            <div id="modalDetails">
                <!-- Ë©≥Á¥∞„ÅØÂãïÁöÑÁîüÊàê -->
            </div>
            <button class="modal-delete" id="modalDeleteBtn" onclick="deleteCurrentReservation()">üóëÔ∏è „Åì„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§</button>
            <button class="modal-close" onclick="closeModal()">Èñâ„Åò„Çã</button>
        </div>
    </div>
    
    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let currentWeekStart = new Date();
        let currentDate = new Date();
        let viewMode = 'week'; // 'week' or 'day'
        let allReservations = [];
        let currentReservation = null; // „É¢„Éº„ÉÄ„É´„ÅßË°®Á§∫‰∏≠„ÅÆ‰∫àÁ¥Ñ
        let allSeats = []; // Âà©Áî®ÂèØËÉΩ„Å™Â∏≠„É™„Çπ„Éà
        
        // ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', () => {
            initializeCalendar();
            loadSeats();
            loadReservations();
            setInterval(loadReservations, 30000);
        });
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÂàùÊúüÂåñ
        function initializeCalendar() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            currentDate = new Date(today);
            
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            currentWeekStart = new Date(today);
            currentWeekStart.setDate(today.getDate() + diff);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            renderCalendar();
        }
        
        // „Éì„É•„Éº„É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function setViewMode(mode) {
            viewMode = mode;
            document.getElementById('weekViewBtn').classList.toggle('active', mode === 'week');
            document.getElementById('dayViewBtn').classList.toggle('active', mode === 'day');
            renderCalendar();
            displayReservations();
        }
        
        // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
        function navigate(direction) {
            if (viewMode === 'week') {
                currentWeekStart.setDate(currentWeekStart.getDate() + (direction * 7));
            } else {
                currentDate.setDate(currentDate.getDate() + direction);
                // ÈÄ±„ÅÆÈñãÂßã„ÇÇÊõ¥Êñ∞
                const dayOfWeek = currentDate.getDay();
                const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
                currentWeekStart = new Date(currentDate);
                currentWeekStart.setDate(currentDate.getDate() + diff);
                currentWeekStart.setHours(0, 0, 0, 0);
            }
            renderCalendar();
            displayReservations();
        }
        
        // „Ç´„É¨„É≥„ÉÄ„ÉºÊèèÁîª
        function renderCalendar() {
            if (viewMode === 'week') {
                renderWeekView();
            } else {
                renderDayView();
            }
            renderMobileView();
            updatePeriodDisplay();
        }
        
        // ÈÄ±Ë°®Á§∫
        function renderWeekView() {
            renderHeader();
            renderBody();
        }
        
        // Êó•Ë°®Á§∫
        function renderDayView() {
            const header = document.getElementById('calendarHeader');
            const body = document.getElementById('calendarBody');
            const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const dayOfWeek = currentDate.getDay();
            
            // „Éò„ÉÉ„ÉÄ„Éº
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            header.innerHTML = `
                <tr>
                    <th>ÊôÇÈñì</th>
                    <th class="today" data-date="${dateStr}">
                        <div class="day-header">${days[dayOfWeek]}</div>
                        <div class="day-date">${currentDate.getDate()}</div>
                    </th>
                </tr>
            `;
            
            // „Éú„Éá„Ç£
            let html = '';
            for (let hour = 10; hour <= 22; hour++) {
                html += `
                    <tr>
                        <td>${hour}:00</td>
                        <td data-date="${dateStr}" data-hour="${hour}" 
                            onclick="showAddReservationModal('${dateStr}', ${hour})"></td>
                    </tr>
                `;
            }
            body.innerHTML = html;
        }
        
        // „Éò„ÉÉ„ÉÄ„ÉºÊèèÁîª
        function renderHeader() {
            const header = document.getElementById('calendarHeader');
            const days = ['Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü', 'Êó•'];
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '<tr><th>ÊôÇÈñì</th>';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(currentWeekStart.getDate() + i);
                date.setHours(0, 0, 0, 0);
                
                const isToday = date.toDateString() === today.toDateString();
                const className = isToday ? 'today' : '';
                
                // „É≠„Éº„Ç´„É´Êó•‰ªò„Çí‰ΩøÁî®Ôºà„Çø„Ç§„É†„Çæ„Éº„É≥„ÇíËÄÉÊÖÆÔºâ
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                const dateStr = `${year}-${month}-${day}`;
                
                html += `<th class="${className}" data-date="${dateStr}">
                    <div class="day-header">${days[i]}</div>
                    <div class="day-date">${date.getDate()}</div>
                </th>`;
            }
            
            html += '</tr>';
            header.innerHTML = html;
        }
        
        // „Éú„Éá„Ç£ÊèèÁîª
        function renderBody() {
            const body = document.getElementById('calendarBody');
            let html = '';
            
            // 10:00„Åã„Çâ22:00„Åæ„Åß
            for (let hour = 10; hour <= 22; hour++) {
                html += '<tr>';
                html += `<td>${hour}:00</td>`;
                
                for (let day = 0; day < 7; day++) {
                    const date = new Date(currentWeekStart);
                    date.setDate(currentWeekStart.getDate() + day);
                    date.setHours(0, 0, 0, 0);
                    
                    // „É≠„Éº„Ç´„É´Êó•‰ªò„Çí‰ΩøÁî®Ôºà„Çø„Ç§„É†„Çæ„Éº„É≥„ÇíËÄÉÊÖÆÔºâ
                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const dayStr = String(date.getDate()).padStart(2, '0');
                    const dateStr = `${year}-${month}-${dayStr}`;
                    
                    html += `<td data-date="${dateStr}" data-hour="${hour}" data-day="${day}" 
                                onclick="showAddReservationModal('${dateStr}', ${hour})"></td>`;
                }
                
                html += '</tr>';
            }
            
            body.innerHTML = html;
        }
        
        // ÊúüÈñìË°®Á§∫Êõ¥Êñ∞
        function updatePeriodDisplay() {
            if (viewMode === 'week') {
                const endDate = new Date(currentWeekStart);
                endDate.setDate(currentWeekStart.getDate() + 6);
                
                const startStr = `${currentWeekStart.getFullYear()}Âπ¥${currentWeekStart.getMonth() + 1}Êúà${currentWeekStart.getDate()}Êó•`;
                const endStr = `${endDate.getMonth() + 1}Êúà${endDate.getDate()}Êó•`;
                
                document.getElementById('currentPeriod').textContent = `${startStr} - ${endStr}`;
            } else {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                const date = currentDate.getDate();
                const days = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                const dayOfWeek = days[currentDate.getDay()];
                
                document.getElementById('currentPeriod').textContent = `${year}Âπ¥${month}Êúà${date}Êó• (${dayOfWeek})`;
            }
        }
        
        // ‰ªäÊó•„Å∏ÁßªÂãï
        function goToToday() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            currentDate = new Date(today);
            
            const dayOfWeek = today.getDay();
            const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
            currentWeekStart = new Date(today);
            currentWeekStart.setDate(today.getDate() + diff);
            currentWeekStart.setHours(0, 0, 0, 0);
            
            renderCalendar();
            displayReservations();
        }
        
        // ‰∫àÁ¥Ñ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadReservations() {
            try {
                const response = await fetch('/api/admin-supabase');
                const data = await response.json();
                
                if (data.reservations) {
                    allReservations = data.reservations;
                    displayReservations();
                    updateStatistics();
                }
            } catch (error) {
                console.error('Error loading reservations:', error);
            }
        }
        
        // „É¢„Éê„Ç§„É´„Éì„É•„ÉºÊèèÁîª
        function renderMobileView() {
            const mobileView = document.getElementById('mobileCalendarView');
            if (!mobileView) return;
            
            const days = ['Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü', 'Êó•'];
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(currentWeekStart);
                date.setDate(currentWeekStart.getDate() + i);
                date.setHours(0, 0, 0, 0);
                
                // „É≠„Éº„Ç´„É´Êó•‰ªò„Çí‰ΩøÁî®
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const dayStr = String(date.getDate()).padStart(2, '0');
                const dateStr = `${year}-${month}-${dayStr}`;
                
                const isToday = date.toDateString() === today.toDateString();
                
                html += `
                    <div class="mobile-day-section">
                        <div class="mobile-day-header ${isToday ? 'today' : ''}">
                            ${days[i]}ÊõúÊó• ${date.getMonth() + 1}Êúà${date.getDate()}Êó•
                        </div>
                        <div class="mobile-day-reservations" data-date="${dateStr}">
                            <!-- ‰∫àÁ¥Ñ„ÅØÂæå„ÅßËøΩÂä† -->
                        </div>
                    </div>
                `;
            }
            
            mobileView.innerHTML = html;
        }
        
        // ‰∫àÁ¥ÑË°®Á§∫
        function displayReservations() {
            if (viewMode === 'week') {
                // PCÁî®Ë°®Á§∫
                displayPCReservations();
                // „É¢„Éê„Ç§„É´Áî®Ë°®Á§∫
                displayMobileReservations();
            } else {
                // Êó•Ë°®Á§∫
                displayDayReservations();
            }
        }
        
        // Êó•Ë°®Á§∫„ÅÆ‰∫àÁ¥ÑË°®Á§∫
        function displayDayReservations() {
            // Êó¢Â≠ò„ÅÆ‰∫àÁ¥Ñ„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.time-slot-reservations').forEach(container => container.remove());
            document.querySelectorAll('.reservation-card').forEach(card => card.remove());
            
            // ÁèæÂú®„ÅÆÊó•‰ªò„Çí„Éï„Ç©„Éº„Éû„ÉÉ„Éà
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const dateStr = `${year}-${month}-${day}`;
            
            // Ë©≤ÂΩìÊó•„ÅÆ‰∫àÁ¥Ñ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const dayReservations = allReservations.filter(r => r.date === dateStr);
            
            // ÊôÇÈñì„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const reservationsByHour = {};
            dayReservations.forEach(reservation => {
                const hour = parseInt(reservation.time.split(':')[0]);
                if (!reservationsByHour[hour]) {
                    reservationsByHour[hour] = [];
                }
                reservationsByHour[hour].push(reservation);
            });
            
            // ÂêÑÊôÇÈñìÂ∏Ø„Å´‰∫àÁ¥Ñ„ÇíÈÖçÁΩÆ
            Object.entries(reservationsByHour).forEach(([hour, reservations]) => {
                const cell = document.querySelector(
                    `td[data-date="${dateStr}"][data-hour="${hour}"]`
                );
                
                if (cell) {
                    const container = document.createElement('div');
                    container.className = 'time-slot-reservations';
                    container.style.width = '100%';
                    
                    reservations.forEach(reservation => {
                        const timeParts = reservation.time.split(':');
                        const card = document.createElement('div');
                        card.className = `reservation-card ${reservation.status}`;
                        card.style.width = 'auto';
                        card.style.marginRight = '0';
                        
                        const seatInfo = reservation.seat_name ? 
                            `<div class="card-seat">üìç${reservation.seat_name}</div>` : '';
                        
                        card.innerHTML = `
                            <div class="card-content">
                                <div class="card-time">${timeParts[0]}:${timeParts[1]}</div>
                                <div class="card-name">${reservation.customer_name || '„Ç≤„Çπ„Éà'}Êßò</div>
                                <div class="card-people">${reservation.people}Âêç</div>
                                ${seatInfo}
                                ${reservation.message ? `<div class="card-message" style="font-size: 10px; color: #999; margin-top: 3px;">${reservation.message}</div>` : ''}
                            </div>
                        `;
                        
                        card.onclick = () => showReservationDetail(reservation);
                        container.appendChild(card);
                    });
                    
                    cell.appendChild(container);
                }
            });
        }
        
        // PCÁî®‰∫àÁ¥ÑË°®Á§∫
        function displayPCReservations() {
            // Êó¢Â≠ò„ÅÆ‰∫àÁ¥Ñ„Ç´„Éº„Éâ„Å®„Ç≥„É≥„ÉÜ„Éä„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.time-slot-reservations').forEach(container => container.remove());
            document.querySelectorAll('.reservation-card').forEach(card => card.remove());
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 7);
            
            // ‰ªäÈÄ±„ÅÆ‰∫àÁ¥Ñ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const weekReservations = allReservations.filter(r => {
                // „É≠„Éº„Ç´„É´Êó•‰ªòÊñáÂ≠óÂàó„ÇíÁîüÊàê„Åó„Å¶ÊØîËºÉ
                const startYear = currentWeekStart.getFullYear();
                const startMonth = String(currentWeekStart.getMonth() + 1).padStart(2, '0');
                const startDay = String(currentWeekStart.getDate()).padStart(2, '0');
                const startDateStr = `${startYear}-${startMonth}-${startDay}`;
                
                const endYear = weekEnd.getFullYear();
                const endMonth = String(weekEnd.getMonth() + 1).padStart(2, '0');
                const endDay = String(weekEnd.getDate()).padStart(2, '0');
                const endDateStr = `${endYear}-${endMonth}-${endDay}`;
                
                return r.date >= startDateStr && r.date < endDateStr;
            });
            
            // ÊôÇÈñì„Å®„Çª„É´„Åî„Å®„Å´‰∫àÁ¥Ñ„Çí„Ç∞„É´„Éº„ÉóÂåñ
            const reservationsByCell = {};
            weekReservations.forEach(reservation => {
                const hour = parseInt(reservation.time.split(':')[0]);
                const key = `${reservation.date}_${hour}`;
                if (!reservationsByCell[key]) {
                    reservationsByCell[key] = [];
                }
                reservationsByCell[key].push(reservation);
            });
            
            // ÂêÑ„Çª„É´„Å´‰∫àÁ¥Ñ„ÇíÈÖçÁΩÆ
            Object.entries(reservationsByCell).forEach(([key, reservations]) => {
                const [date, hour] = key.split('_');
                const cell = document.querySelector(
                    `td[data-date="${date}"][data-hour="${hour}"]`
                );
                
                if (cell) {
                    // „Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
                    const container = document.createElement('div');
                    container.className = 'time-slot-reservations';
                    
                    // ÊôÇÈñìÈ†Ü„Å´„ÇΩ„Éº„Éà
                    reservations.sort((a, b) => a.time.localeCompare(b.time));
                    
                    // ÊúÄÂ§ß3‰ª∂„Åæ„ÅßË°®Á§∫„ÄÅ„Åù„Çå‰ª•‰∏ä„ÅØ„Äå+N‰ª∂„ÄçË°®Á§∫
                    const maxDisplay = 3;
                    const displayReservations = reservations.slice(0, maxDisplay);
                    const remaining = reservations.length - maxDisplay;
                    
                    displayReservations.forEach(reservation => {
                        const timeParts = reservation.time.split(':');
                        const card = document.createElement('div');
                        card.className = `reservation-card ${reservation.status}`;
                        
                        // Â∏≠ÊÉÖÂ†±„ÇíÂèñÂæó
                        const seatInfo = reservation.seat_name ? 
                            `<div class="card-seat">üìç${reservation.seat_name}</div>` : '';
                        
                        card.innerHTML = `
                            <div class="card-content">
                                <div class="card-time">${timeParts[0]}:${timeParts[1]}</div>
                                <div class="card-name">${reservation.customer_name || '„Ç≤„Çπ„Éà'}Êßò</div>
                                <div class="card-people">${reservation.people}Âêç</div>
                                ${seatInfo}
                            </div>
                        `;
                        
                        card.onclick = () => showReservationDetail(reservation);
                        container.appendChild(card);
                    });
                    
                    // ÊÆã„Çä„ÅÆ‰∫àÁ¥Ñ„Åå„ÅÇ„ÇãÂ†¥Âêà
                    if (remaining > 0) {
                        const moreIndicator = document.createElement('div');
                        moreIndicator.className = 'more-reservations';
                        moreIndicator.textContent = `+${remaining}‰ª∂`;
                        moreIndicator.onclick = () => {
                            // „Åô„Åπ„Å¶„ÅÆ‰∫àÁ¥Ñ„ÇíË°®Á§∫„Åô„Çã„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                            showAllReservationsForSlot(reservations, date, hour);
                        };
                        container.appendChild(moreIndicator);
                    }
                    
                    cell.appendChild(container);
                }
            });
        }
        
        // ÁâπÂÆöÊôÇÈñìÂ∏Ø„ÅÆ„Åô„Åπ„Å¶„ÅÆ‰∫àÁ¥Ñ„ÇíË°®Á§∫
        function showAllReservationsForSlot(reservations, date, hour) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">${date} ${hour}:00„ÅÆ‰∫àÁ¥Ñ‰∏ÄË¶ß</div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${reservations.map(r => `
                            <div class="detail-row" style="cursor: pointer; padding: 10px; border: 1px solid #e0e0e0; margin-bottom: 5px; border-radius: 4px;"
                                 onclick="showReservationDetail(${JSON.stringify(r).replace(/"/g, '&quot;')})">
                                <strong>${r.time.substring(0, 5)}</strong> - 
                                ${r.customer_name || '„Ç≤„Çπ„Éà'}Êßò (${r.people}Âêç)
                            </div>
                        `).join('')}
                    </div>
                    <button class="modal-close" onclick="this.closest('.modal').remove()">Èñâ„Åò„Çã</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // „É¢„Éê„Ç§„É´Áî®‰∫àÁ¥ÑË°®Á§∫
        function displayMobileReservations() {
            const mobileView = document.getElementById('mobileCalendarView');
            if (!mobileView) return;
            
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 7);
            
            // ‰ªäÈÄ±„ÅÆ‰∫àÁ¥Ñ„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const weekReservations = allReservations.filter(r => {
                // „É≠„Éº„Ç´„É´Êó•‰ªòÊñáÂ≠óÂàó„ÇíÁîüÊàê„Åó„Å¶ÊØîËºÉ
                const startYear = currentWeekStart.getFullYear();
                const startMonth = String(currentWeekStart.getMonth() + 1).padStart(2, '0');
                const startDay = String(currentWeekStart.getDate()).padStart(2, '0');
                const startDateStr = `${startYear}-${startMonth}-${startDay}`;
                
                const endYear = weekEnd.getFullYear();
                const endMonth = String(weekEnd.getMonth() + 1).padStart(2, '0');
                const endDay = String(weekEnd.getDate()).padStart(2, '0');
                const endDateStr = `${endYear}-${endMonth}-${endDay}`;
                
                return r.date >= startDateStr && r.date < endDateStr;
            });
            
            // Êó•‰ªò„Åî„Å®„Å´„Ç∞„É´„Éº„ÉóÂåñ
            const reservationsByDate = {};
            weekReservations.forEach(r => {
                if (!reservationsByDate[r.date]) {
                    reservationsByDate[r.date] = [];
                }
                reservationsByDate[r.date].push(r);
            });
            
            // ÂêÑÊó•„ÅÆ‰∫àÁ¥Ñ„ÇíË°®Á§∫
            document.querySelectorAll('.mobile-day-reservations').forEach(container => {
                const date = container.dataset.date;
                const dayReservations = reservationsByDate[date] || [];
                
                if (dayReservations.length === 0) {
                    container.innerHTML = '<div class="mobile-empty-message">‰∫àÁ¥Ñ„Å™„Åó</div>';
                } else {
                    // ÊôÇÈñìÈ†Ü„Å´„ÇΩ„Éº„Éà
                    dayReservations.sort((a, b) => a.time.localeCompare(b.time));
                    
                    container.innerHTML = dayReservations.map(r => {
                        const timeParts = r.time.split(':');
                        const seatInfo = r.seat_name ? 
                            `<div class="mobile-reservation-seat">üìç${r.seat_name}</div>` : '';
                        return `
                            <div class="mobile-reservation-card ${r.status}" 
                                 onclick='showReservationDetail(${JSON.stringify(r).replace(/'/g, "&apos;")})'>
                                <div class="mobile-reservation-time">${timeParts[0]}:${timeParts[1]}</div>
                                <div class="mobile-reservation-name">${r.customer_name || '„Ç≤„Çπ„Éà'}Êßò</div>
                                <div class="mobile-reservation-people">${r.people}Âêç</div>
                                ${seatInfo}
                            </div>
                        `;
                    }).join('');
                }
            });
        }
        
        // ‰∫àÁ¥ÑË©≥Á¥∞Ë°®Á§∫
        function showReservationDetail(reservation) {
            currentReservation = reservation; // ÂâäÈô§Áî®„Å´‰øùÂ≠ò
            
            const statusText = {
                'pending': '‰∫àÁ¥ÑÁ¢∫ÂÆö',
                'confirmed': 'Á¢∫Ë™çÊ∏à„Åø',
                'cancelled': '„Ç≠„É£„É≥„Çª„É´'
            };
            
            document.getElementById('modalTitle').textContent = 
                `${reservation.customer_name || '„Ç≤„Çπ„Éà'}Êßò„ÅÆ„Åî‰∫àÁ¥Ñ`;
            
            document.getElementById('modalDetails').innerHTML = `
                <div class="detail-row">
                    <div class="detail-label">‰∫àÁ¥ÑID</div>
                    <div class="detail-value">#${reservation.id}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Êó•‰ªò</div>
                    <div class="detail-value">${reservation.date}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">ÊôÇÈñì</div>
                    <div class="detail-value">${reservation.time.substring(0, 5)}</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">‰∫∫Êï∞</div>
                    <div class="detail-value">${reservation.people}Âêç</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">„Çπ„ÉÜ„Éº„Çø„Çπ</div>
                    <div class="detail-value">${statusText[reservation.status] || reservation.status}</div>
                </div>
                ${reservation.seat_name ? `
                <div class="detail-row">
                    <div class="detail-label">Â∏≠</div>
                    <div class="detail-value">üìç ${reservation.seat_name}</div>
                </div>
                ` : ''}
                <div class="detail-row">
                    <div class="detail-label">‰ΩúÊàêÊó•ÊôÇ</div>
                    <div class="detail-value">${new Date(reservation.created_at).toLocaleString('ja-JP')}</div>
                </div>
            `;
            
            document.getElementById('detailModal').classList.add('show');
        }
        
        // ÁèæÂú®„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§
        async function deleteCurrentReservation() {
            if (!currentReservation) return;
            
            const confirmMessage = `‰∫àÁ¥ÑID: #${currentReservation.id}\n${currentReservation.customer_name || '„Ç≤„Çπ„Éà'}Êßò\n${currentReservation.date} ${currentReservation.time.substring(0, 5)}\n\n„Åì„ÅÆ‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`;
            
            if (!confirm(confirmMessage)) return;
            
            try {
                const response = await fetch(`/api/admin-delete?id=${currentReservation.id}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    alert('‰∫àÁ¥Ñ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
                    closeModal();
                    loadReservations(); // „Éá„Éº„ÇøÂÜçË™≠„ÅøËæº„Åø
                } else {
                    alert(`ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}`);
                }
            } catch (error) {
                console.error('Delete error:', error);
                alert('ÂâäÈô§Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        }
        
        // „É¢„Éº„ÉÄ„É´Èñâ„Åò„Çã
        function closeModal() {
            document.getElementById('detailModal').classList.remove('show');
            currentReservation = null;
        }
        
        // Áµ±Ë®àÊõ¥Êñ∞
        function updateStatistics() {
            const today = new Date().toISOString().split('T')[0];
            const weekEnd = new Date(currentWeekStart);
            weekEnd.setDate(currentWeekStart.getDate() + 7);
            
            // Êú¨Êó•„ÅÆ‰∫àÁ¥Ñ
            const todayReservations = allReservations.filter(r => 
                r.date === today && r.status !== 'cancelled'
            );
            document.getElementById('todayCount').textContent = todayReservations.length;
            
            // ‰ªäÈÄ±„ÅÆ‰∫àÁ¥Ñ
            const weekReservations = allReservations.filter(r => {
                const resDate = new Date(r.date);
                return resDate >= currentWeekStart && resDate < weekEnd && r.status !== 'cancelled';
            });
            document.getElementById('weekCount').textContent = weekReservations.length;
            
            // ‰∫àÁ¥ÑÁéá
            const maxReservations = 7 * 50;
            const occupancy = Math.round((weekReservations.length / maxReservations) * 100);
            document.getElementById('occupancyRate').textContent = `${occupancy}%`;
            
            // Âπ≥Âùá‰∫∫Êï∞
            if (weekReservations.length > 0) {
                const totalPeople = weekReservations.reduce((sum, r) => sum + r.people, 0);
                const avgPeople = (totalPeople / weekReservations.length).toFixed(1);
                document.getElementById('avgPeople').textContent = `${avgPeople}Âêç`;
            } else {
                document.getElementById('avgPeople').textContent = '0Âêç';
            }
        }
        
        // Â∏≠„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        async function loadSeats() {
            try {
                const response = await fetch('/api/seats-manage');
                const data = await response.json();
                
                if (data.success) {
                    allSeats = data.seats || [];
                }
            } catch (error) {
                console.error('Error loading seats:', error);
            }
        }
        
        // ‰∫àÁ¥ÑËøΩÂä†„É¢„Éº„ÉÄ„É´Ë°®Á§∫
        async function showAddReservationModal(date, hour) {
            // Êó¢Â≠ò„ÅÆ‰∫àÁ¥ÑË©≥Á¥∞„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØÁÑ°Ë¶ñ
            if (event.target.closest('.reservation-card') || event.target.closest('.more-reservations')) {
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.id = 'addReservationModal';
            
            const timeOptions = [];
            for (let min = 0; min < 60; min += 15) {
                const timeStr = `${hour.toString().padStart(2, '0')}:${min.toString().padStart(2, '0')}`;
                timeOptions.push(`<option value="${timeStr}">${timeStr}</option>`);
            }
            
            // Â∏≠„Ç™„Éó„Ç∑„Éß„É≥„ÇíÁîüÊàê
            const seatOptions = allSeats.length > 0 
                ? allSeats.map(seat => 
                    `<option value="${seat.id}">${seat.name} (${seat.capacity}Âêç)</option>`
                  ).join('')
                : '<option value="">Â∏≠ÊÉÖÂ†±„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</option>';
            
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-title">Êñ∞Ë¶è‰∫àÁ¥ÑËøΩÂä†</div>
                    <form id="addReservationForm" onsubmit="submitNewReservation(event)">
                        <div class="form-group">
                            <label class="form-label">„ÅäÂêçÂâç <span style="color: red;">*</span></label>
                            <input type="text" class="form-input" name="customer_name" required 
                                   placeholder="Â±±Áî∞Â§™ÈÉé">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Êó•‰ªò <span style="color: red;">*</span></label>
                                <input type="date" class="form-input" name="date" value="${date}" required
                                       onchange="checkSeatAvailability()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÊôÇÈñì <span style="color: red;">*</span></label>
                                <select class="form-input" name="time" required onchange="checkSeatAvailability()">
                                    ${timeOptions.join('')}
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">‰∫∫Êï∞ <span style="color: red;">*</span></label>
                                <select class="form-input" name="people" required onchange="checkSeatAvailability()">
                                    ${Array.from({length: 20}, (_, i) => 
                                        `<option value="${i+1}">${i+1}Âêç</option>`
                                    ).join('')}
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Â∏≠„ÇíÂâ≤„ÇäÂΩì„Å¶</label>
                                <select class="form-input" name="seat_id" id="seatSelect">
                                    <option value="">Ëá™ÂãïÂâ≤„ÇäÂΩì„Å¶</option>
                                    ${seatOptions}
                                </select>
                                <small id="seatAvailability" style="color: #666; font-size: 12px;"></small>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">ÈõªË©±Áï™Âè∑</label>
                                <input type="tel" class="form-input" name="phone" 
                                       placeholder="090-1234-5678">
                            </div>
                            <div class="form-group">
                                <label class="form-label">„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                                <input type="email" class="form-input" name="email" 
                                       placeholder="example@example.com">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">„É°„ÉÉ„Çª„Éº„Ç∏„ÉªË¶ÅÊúõ</label>
                            <textarea class="form-input" name="message" rows="3" 
                                      placeholder="„Ç¢„É¨„É´„ÇÆ„ÉºÊÉÖÂ†±„ÇÑÁâπÂà•„Å™Ë¶ÅÊúõ„Å™„Å©"></textarea>
                        </div>
                        
                        <button type="submit" class="form-submit">‚úÖ ‰∫àÁ¥Ñ„ÇíËøΩÂä†</button>
                        <button type="button" class="modal-close" onclick="closeAddModal()">„Ç≠„É£„É≥„Çª„É´</button>
                    </form>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ÂàùÂõû„ÅÆÂ∏≠Á©∫„ÅçÁä∂Ê≥Å„ÉÅ„Çß„ÉÉ„ÇØ
            setTimeout(checkSeatAvailability, 100);
        }
        
        // Â∏≠„ÅÆÁ©∫„ÅçÁä∂Ê≥Å„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        async function checkSeatAvailability() {
            const form = document.getElementById('addReservationForm');
            if (!form) return;
            
            const date = form.date.value;
            const time = form.time.value;
            const people = form.people.value;
            
            if (!date || !time) return;
            
            try {
                const response = await fetch('/api/check-seat-availability', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ date, time, people })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const seatSelect = document.getElementById('seatSelect');
                    const availabilityText = document.getElementById('seatAvailability');
                    
                    // Âà©Áî®ÂèØËÉΩ„Å™Â∏≠„ÇíÊõ¥Êñ∞
                    seatSelect.innerHTML = '<option value="">Ëá™ÂãïÂâ≤„ÇäÂΩì„Å¶</option>';
                    
                    if (data.availableSeats.length > 0) {
                        data.availableSeats.forEach(seat => {
                            const option = document.createElement('option');
                            option.value = seat.id;
                            option.textContent = `${seat.name} (${seat.capacity}Âêç)`;
                            if (data.recommendedSeat && seat.id === data.recommendedSeat.id) {
                                option.textContent += ' ‚òÖ„Åä„Åô„Åô„ÇÅ';
                                option.selected = true;
                            }
                            seatSelect.appendChild(option);
                        });
                        
                        availabilityText.textContent = `${data.availableSeats.length}Â∏≠Âà©Áî®ÂèØËÉΩ`;
                        availabilityText.style.color = '#06c755';
                    } else {
                        availabilityText.textContent = '„Åì„ÅÆÊôÇÈñìÂ∏Ø„ÅØÊ∫ÄÂ∏≠„Åß„Åô';
                        availabilityText.style.color = '#ef5350';
                    }
                }
            } catch (error) {
                console.error('Check availability error:', error);
            }
        }
        
        // ‰∫àÁ¥ÑËøΩÂä†„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeAddModal() {
            const modal = document.getElementById('addReservationModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // Êñ∞Ë¶è‰∫àÁ¥Ñ„ÇíÈÄÅ‰ø°
        async function submitNewReservation(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const data = Object.fromEntries(formData);
            
            try {
                const response = await fetch('/api/admin-create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    alert('‰∫àÁ¥Ñ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
                    closeAddModal();
                    loadReservations(); // „Éá„Éº„ÇøÂÜçË™≠„ÅøËæº„Åø
                } else {
                    alert(`ËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'}`);
                }
            } catch (error) {
                console.error('Add error:', error);
                alert('ËøΩÂä†Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        }
        
        // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
        window.onclick = function(event) {
            const detailModal = document.getElementById('detailModal');
            const addModal = document.getElementById('addReservationModal');
            
            if (event.target === detailModal) {
                closeModal();
            }
            if (event.target === addModal) {
                closeAddModal();
            }
        }
    </script>
</body>
</html>