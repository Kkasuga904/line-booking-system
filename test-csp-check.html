<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CSPå‹•ä½œç¢ºèªãƒ„ãƒ¼ãƒ«</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #00ff00;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #00ff00;
            border-radius: 5px;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffff00; }
        button {
            background: #333;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px 20px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #00ff00;
            color: #000;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
<h1>ğŸ”’ CSP (Content Security Policy) å‹•ä½œç¢ºèªãƒ„ãƒ¼ãƒ«</h1>

<div class="section">
    <h2>ğŸ“‹ ç¾åœ¨ã®CSPãƒãƒªã‚·ãƒ¼</h2>
    <pre id="cspPolicy">å–å¾—ä¸­...</pre>
</div>

<div class="section">
    <h2>ğŸ§ª ãƒ†ã‚¹ãƒˆé …ç›®</h2>
    <button onclick="testInlineScript()">ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</button>
    <button onclick="testExternalScript()">å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</button>
    <button onclick="testInlineStyle()">ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«</button>
    <button onclick="testMedia()">ãƒ¡ãƒ‡ã‚£ã‚¢èª­ã¿è¾¼ã¿</button>
    <button onclick="testImage()">ç”»åƒèª­ã¿è¾¼ã¿</button>
    <button onclick="testDataURI()">Data URI</button>
    <button onclick="testBlob()">Blob URL</button>
</div>

<div class="section">
    <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
    <div id="results"></div>
</div>

<div class="section">
    <h2>ğŸ› ï¸ DevToolsç¢ºèªã‚³ãƒãƒ³ãƒ‰</h2>
    <pre>
// CSPãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ç¢ºèª
fetch(location.href).then(r => {
    console.log('CSP:', r.headers.get('Content-Security-Policy'));
    return r.headers.get('Content-Security-Policy');
});

// CSPé•åã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
document.addEventListener('securitypolicyviolation', e => {
    console.warn('CSPé•å:', {
        directive: e.violatedDirective,
        blocked: e.blockedURI,
        policy: e.originalPolicy
    });
});

// ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ä¸€è¦§
fetch(location.href).then(r => {
    ['Content-Security-Policy', 'X-Frame-Options', 'X-Content-Type-Options', 'X-XSS-Protection']
        .forEach(h => console.log(`${h}:`, r.headers.get(h)));
});
    </pre>
</div>

<script>
// CSPãƒãƒªã‚·ãƒ¼å–å¾—
async function fetchCSP() {
    try {
        const response = await fetch(location.href);
        const csp = response.headers.get('Content-Security-Policy');
        document.getElementById('cspPolicy').textContent = csp || 'CSPãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“';
        
        if (csp) {
            // CSPã‚’è§£æã—ã¦è¡¨ç¤º
            const policies = csp.split(';').map(p => p.trim());
            const formatted = policies.map(p => {
                const [directive, ...values] = p.split(' ');
                return `${directive}: ${values.join(' ')}`;
            }).join('\n');
            document.getElementById('cspPolicy').textContent = formatted;
        }
    } catch (error) {
        document.getElementById('cspPolicy').textContent = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
    }
}

// ãƒ†ã‚¹ãƒˆçµæœã‚’è¿½åŠ 
function addResult(test, success, message) {
    const results = document.getElementById('results');
    const div = document.createElement('div');
    div.className = success ? 'success' : 'error';
    div.textContent = `[${new Date().toLocaleTimeString()}] ${test}: ${success ? 'âœ…' : 'âŒ'} ${message}`;
    results.appendChild(div);
}

// CSPé•åã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
document.addEventListener('securitypolicyviolation', (e) => {
    addResult('CSPé•åæ¤œå‡º', false, 
        `Directive: ${e.violatedDirective}, Blocked: ${e.blockedURI}`);
});

// ãƒ†ã‚¹ãƒˆé–¢æ•°
function testInlineScript() {
    try {
        eval("console.log('Inline script test');");
        addResult('ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ', true, 'å®Ÿè¡Œå¯èƒ½ï¼ˆunsafe-inlineæœ‰åŠ¹ï¼‰');
    } catch (e) {
        addResult('ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ', false, 'ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
    }
}

function testExternalScript() {
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
    script.onload = () => addResult('å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ', true, 'CDNèª­ã¿è¾¼ã¿æˆåŠŸ');
    script.onerror = () => addResult('å¤–éƒ¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆ', false, 'CDNèª­ã¿è¾¼ã¿å¤±æ•—');
    document.head.appendChild(script);
}

function testInlineStyle() {
    const div = document.createElement('div');
    div.style.cssText = 'color: red; font-size: 20px;';
    div.textContent = 'ã‚¹ã‚¿ã‚¤ãƒ«ãƒ†ã‚¹ãƒˆ';
    document.body.appendChild(div);
    const computed = window.getComputedStyle(div);
    if (computed.color === 'rgb(255, 0, 0)') {
        addResult('ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«', true, 'é©ç”¨æˆåŠŸ');
    } else {
        addResult('ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«', false, 'ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');
    }
    div.remove();
}

function testMedia() {
    const audio = new Audio('data