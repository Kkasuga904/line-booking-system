(()=>{"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e){if(null==e||""===e)return"";if("number"==typeof e&&Number.isFinite(e)){if(e<=24&&Number.isInteger(e))return String(e).padStart(2,"0")+":00";var t=Math.floor(e/60),n=e%60;return String(t).padStart(2,"0")+":"+String(n).padStart(2,"0")}var r=String(e).trim(),a=(r=r.replace(/[：]/g,":").replace(/[．。]/g,".").replace(/[ｰー‐\-]/g,":")).match(/^(\d{1,2})[:\.](\d{1,2})$/);if(a){var i=Math.min(23,Math.max(0,+a[1])),o=Math.min(59,Math.max(0,+a[2]));return String(i).padStart(2,"0")+":"+String(o).padStart(2,"0")}if(a=r.match(/^(\d{1,2})時(?:(\d{1,2})分?)?$/)){var l=Math.min(23,Math.max(0,+a[1])),c=a[2]?Math.min(59,Math.max(0,+a[2])):0;return String(l).padStart(2,"0")+":"+String(c).padStart(2,"0")}if(a=r.match(/^(\d{1,2})時半$/))return String(+a[1]).padStart(2,"0")+":30";if(/^\d{3,4}$/.test(r)){var d=r.padStart(4,"0"),u=+d.slice(0,2),s=+d.slice(2);if(u<=23&&s<=59)return d.slice(0,2)+":"+d.slice(2)}return/^\d{1,2}$/.test(r)?r.padStart(2,"0")+":00":/^\d{2}:\d{2}$/.test(r)?r:""}function n(n,r){var a,i=function(t,n){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(t))||n&&t&&"number"==typeof t.length){r&&(t=r);var a=0,i=function(){};return{s:i,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var e=r.next();return l=e.done,e},e:function(e){c=!0,o=e},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw o}}}}(r);try{for(i.s();!(a=i.n()).done;){var o=t(a.value.split(".").reduce(function(e,t){return e?e[t]:void 0},n));if(o)return o}}catch(e){i.e(e)}finally{i.f()}return""}function r(e){return{s:n(e,["startTime","start","from","time.start","timeStart","start_minutes","startMinute","startMin","start_time_minutes","startAt","start_at","begin","beginTime"]),e:n(e,["endTime","end","to","time.end","timeEnd","end_minutes","endMinute","endMin","end_time_minutes","endAt","end_at","finish","finishTime"]),isAllDay:"allday"===(null==e?void 0:e.dateMode)||!0===(null==e?void 0:e.allDay)}}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){l(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t,n){return(t=function(e){var t=function(e){if("object"!=a(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==a(t)?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c="capacityRules";function d(e){var t=o({},e),n=r(t),a=n.s,i=n.e,l=n.isAllDay;return a&&i?(t.startTime=a,t.endTime=i):l?(t.startTime="00:00",t.endTime="23:59"):(t.startTime=a||"",t.endTime=i||""),t.controlType||(t.controlType="groups"),t.dateMode||(t.date?t.dateMode="single":t.startDate&&t.endDate?t.dateMode="range":void 0!==t.weekday&&null!==t.weekday?t.dateMode="weekly":t.dateMode="single"),t.schemaVersion=3,t}function u(){try{var e=JSON.parse(localStorage.getItem(c)||"[]").map(d);return localStorage.setItem(c,JSON.stringify(e)),e}catch(e){return console.error("Failed to load rules:",e),[]}}function s(e){try{var t=e.map(d);return localStorage.setItem(c,JSON.stringify(t)),!0}catch(e){return console.error("Failed to save rules:",e),!1}}function m(e){var t=u().filter(function(t){return t.id!==e&&t.id!==Number(e)});return s(t),t}function y(e){if(!e)return"";var t=new Date(e);return"".concat(t.getMonth()+1,"/").concat(t.getDate())}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"rulesContainer",t=document.getElementById(e);if(t){var n=u();t.innerHTML="",0!==n.length?n.forEach(function(e){t.appendChild(function(e){var t=document.createElement("div");t.className="rule-card",t.dataset.ruleId=e.id;var n="";switch(e.dateMode){case"single":n=e.date?y(e.date):"日付未設定";break;case"range":var a=e.startDate?y(e.startDate):"",i=e.endDate?y(e.endDate):"";n="".concat(a," 〜 ").concat(i);break;case"weekly":n="毎週".concat(["日","月","火","水","木","金","土"][e.weekday]||"","曜日");break;case"allday":n="終日";break;default:n="設定なし"}var o=r(e),l=o.s,c=o.e,d="allday"===e.dateMode?"終日":l&&c?"".concat(l," - ").concat(c):"(時刻なし)",u="groups"===e.controlType?"".concat(e.groups||0,"組まで"):"".concat(e.people||0,"名まで");return t.innerHTML='\n    <div class="rule-header">\n      <span class="rule-date">'.concat(n,'</span>\n      <button class="delete-btn" onclick="window.deleteRuleHandler(').concat(e.id,')">削除</button>\n    </div>\n    <div class="rule-body">\n      <div class="rule-time">').concat(d,'</div>\n      <div class="rule-capacity">').concat(u,"</div>\n    </div>\n  "),t}(e))}):t.innerHTML='<p class="no-rules">設定されたルールはありません</p>'}}var g={currentEditingRule:null,isInitialized:!1};function p(e){e.preventDefault();var n,r,a,i,l=new FormData(e.target),c={dateMode:l.get("dateMode"),controlType:l.get("controlType")};switch(c.dateMode){case"single":c.date=l.get("date");break;case"range":c.startDate=l.get("startDate"),c.endDate=l.get("endDate");break;case"weekly":c.weekday=parseInt(l.get("weekday"))}if("allday"!==c.dateMode){var m=t(l.get("startTime")),y=t(l.get("endTime"));m&&(c.startTime=m),y&&(c.endTime=y)}"groups"===c.controlType?c.groups=parseInt(l.get("groups"))||0:c.people=parseInt(l.get("people"))||0,g.currentEditingRule?(n=g.currentEditingRule.id,r=c,-1!==(i=(a=u()).findIndex(function(e){return e.id===n||e.id===Number(n)}))&&(a[i]=d(o(o(o({},a[i]),r),{},{updatedAt:(new Date).toISOString()})),s(a)),g.currentEditingRule=null):function(e){var t=u(),n=d(o(o({},e),{},{id:e.id||Date.now(),createdAt:e.createdAt||(new Date).toISOString()}));t.push(n),s(t)}(c),e.target.reset(),f()}function v(e){var t=e.target.value,n={single:document.getElementById("singleDateContainer"),range:document.getElementById("rangeDateContainer"),weekly:document.getElementById("weeklyContainer"),time:document.getElementById("timeContainer")};switch(Object.values(n).forEach(function(e){e&&(e.style.display="none")}),t){case"single":n.single&&(n.single.style.display="block"),n.time&&(n.time.style.display="block");break;case"range":n.range&&(n.range.style.display="block"),n.time&&(n.time.style.display="block");break;case"weekly":n.weekly&&(n.weekly.style.display="block"),n.time&&(n.time.style.display="block")}}function b(e){var t=e.target.value,n=document.getElementById("groupsContainer"),r=document.getElementById("peopleContainer");"groups"===t?(n&&(n.style.display="block"),r&&(r.style.display="none")):(n&&(n.style.display="none"),r&&(r.style.display="block"))}"undefined"!=typeof window&&window.addEventListener("DOMContentLoaded",function(){var e;g.isInitialized||(console.log("予約制御アプリケーション初期化中..."),e=u(),console.log("マイグレーション完了: ".concat(e.length,"件のルール")),window.deleteRuleHandler=function(e){confirm("このルールを削除しますか？")&&(m(e),f())},f(),function(){var e=document.getElementById("ruleForm");e&&e.addEventListener("submit",p);var t=document.getElementById("dateMode");t&&t.addEventListener("change",v),document.querySelectorAll('input[name="controlType"]').forEach(function(e){e.addEventListener("change",b)}),window.deleteRuleHandler=function(e){confirm("このルールを削除しますか？")&&(m(e),f())}}(),v({target:{value:"single"}}),b({target:{value:"groups"}}),g.isInitialized=!0,console.log("初期化完了"))})})();