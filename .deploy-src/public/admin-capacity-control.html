<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫àÁ¥ÑÂà∂ÈôêÁÆ°ÁêÜ - ÁÆ°ÁêÜÁîªÈù¢</title>
    
    <!-- ÂÖ±ÈÄöCSS -->
    <link rel="stylesheet" href="/css/admin-common.css">
    <link rel="stylesheet" href="/css/sidebar-menu.css">
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .main-container {
            padding: 20px;
            margin-left: 0;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            margin: 0;
            color: #333;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            margin: 0 0 20px 0;
            color: #333;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .restriction-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .restriction-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .restriction-info {
            flex: 1;
        }

        .restriction-date {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .restriction-details {
            color: #666;
            font-size: 14px;
        }

        .restriction-status {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-blocked {
            background: #ffebee;
            color: #c62828;
        }

        .status-limited {
            background: #fff3e0;
            color: #ef6c00;
        }

        .btn-delete {
            padding: 5px 10px;
            background: #ff5252;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #ff1744;
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .time-slot {
            padding: 8px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .time-slot:hover {
            border-color: #667eea;
            background: #f5f7ff;
        }

        .time-slot.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .time-slot.blocked {
            background: #ff5252;
            color: white;
            border-color: #ff5252;
        }
        
        .time-slot.limited {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
        }

        .quick-select-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .quick-btn {
            padding: 6px 12px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .quick-btn:hover {
            background: #667eea;
            color: white;
        }

        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .time-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>üö´ ‰∫àÁ¥ÑÂà∂ÈôêÁÆ°ÁêÜ</h1>
        </div>

        <div class="content-grid">
            <!-- Êó•‰ªòÊåáÂÆöÂà∂Èôê -->
            <div class="card">
                <h2>üìÖ ÁâπÂÆöÊó•„ÅÆÂà∂Èôê</h2>
                <form id="dateRestrictionForm">
                    <div class="form-group">
                        <label for="restrictionDate">Êó•‰ªò</label>
                        <input type="date" id="restrictionDate" required>
                    </div>
                    
                    <div class="form-group">
                        <label>ÊôÇÈñìÂ∏ØË®≠ÂÆöÊñπÊ≥ï</label>
                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="timeSelectMode" value="range" checked onchange="toggleTimeSelectMode()">
                                ÊôÇÈñìÁØÑÂõ≤„ÅßÊåáÂÆö
                            </label>
                            <label style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" name="timeSelectMode" value="individual" onchange="toggleTimeSelectMode()">
                                ÂÄãÂà•„Å´ÈÅ∏Êäû
                            </label>
                        </div>
                        
                        <!-- ÊôÇÈñìÁØÑÂõ≤ÊåáÂÆö -->
                        <div id="timeRangeMode">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <select id="startTime" style="flex: 1;">
                                    <option value="11:00">11:00</option>
                                    <option value="12:00">12:00</option>
                                    <option value="13:00">13:00</option>
                                    <option value="14:00">14:00</option>
                                    <option value="15:00">15:00</option>
                                    <option value="16:00">16:00</option>
                                    <option value="17:00">17:00</option>
                                    <option value="18:00" selected>18:00</option>
                                    <option value="19:00">19:00</option>
                                    <option value="20:00">20:00</option>
                                    <option value="21:00">21:00</option>
                                    <option value="22:00">22:00</option>
                                </select>
                                <span>„Äú</span>
                                <select id="endTime" style="flex: 1;">
                                    <option value="11:00">11:00</option>
                                    <option value="12:00">12:00</option>
                                    <option value="13:00">13:00</option>
                                    <option value="14:00">14:00</option>
                                    <option value="15:00">15:00</option>
                                    <option value="16:00">16:00</option>
                                    <option value="17:00">17:00</option>
                                    <option value="18:00">18:00</option>
                                    <option value="19:00">19:00</option>
                                    <option value="20:00">20:00</option>
                                    <option value="21:00" selected>21:00</option>
                                    <option value="22:00">22:00</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- ÂÄãÂà•ÈÅ∏Êäû -->
                        <div id="individualMode" style="display: none;">
                            <div class="quick-select-buttons">
                                <button type="button" class="quick-btn" onclick="selectAllTimes()">„Åô„Åπ„Å¶ÈÅ∏Êäû</button>
                                <button type="button" class="quick-btn" onclick="clearAllTimes()">„Åô„Åπ„Å¶Ëß£Èô§</button>
                                <button type="button" class="quick-btn" onclick="selectLunchTime()">„É©„É≥„ÉÅ„Çø„Ç§„É†</button>
                                <button type="button" class="quick-btn" onclick="selectDinnerTime()">„Éá„Ç£„Éä„Éº„Çø„Ç§„É†</button>
                            </div>
                            <div class="time-grid" id="timeGrid">
                                <div class="time-slot" data-time="11:00">11:00</div>
                                <div class="time-slot" data-time="12:00">12:00</div>
                                <div class="time-slot" data-time="13:00">13:00</div>
                                <div class="time-slot" data-time="14:00">14:00</div>
                                <div class="time-slot" data-time="15:00">15:00</div>
                                <div class="time-slot" data-time="16:00">16:00</div>
                                <div class="time-slot" data-time="17:00">17:00</div>
                                <div class="time-slot" data-time="18:00">18:00</div>
                                <div class="time-slot" data-time="19:00">19:00</div>
                                <div class="time-slot" data-time="20:00">20:00</div>
                                <div class="time-slot" data-time="21:00">21:00</div>
                                <div class="time-slot" data-time="22:00">22:00</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="restrictionType">Âà∂Èôê„Çø„Ç§„Éó</label>
                        <select id="restrictionType" required>
                            <option value="limit">‰∫àÁ¥ÑÊï∞Âà∂Èôê</option>
                            <option value="block">‰∫àÁ¥Ñ„Éñ„É≠„ÉÉ„ÇØ</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="maxCapacityGroup">
                        <label for="maxCapacity">ÊúÄÂ§ß‰∫àÁ¥ÑÊï∞</label>
                        <input type="number" id="maxCapacity" min="0" max="100" value="4">
                    </div>
                    
                    <div class="form-group">
                        <label for="restrictionReason">ÁêÜÁî±Ôºà‰ªªÊÑèÔºâ</label>
                        <textarea id="restrictionReason" rows="2" placeholder="‰æãÔºö„Çπ„Çø„ÉÉ„Éï‰∏çË∂≥„ÄÅ„Ç§„Éô„É≥„ÉàÈñãÂÇ¨„Å™„Å©"></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span>‚ûï</span> Âà∂Èôê„ÇíËøΩÂä†
                    </button>
                </form>
            </div>

            <!-- ÂÆöÊúüÂà∂ÈôêÔºàÊõúÊó•Ôºâ -->
            <div class="card">
                <h2>üìÜ ÂÆöÊúüÂà∂ÈôêÔºàÊõúÊó•Ôºâ</h2>
                <form id="weeklyRestrictionForm">
                    <div class="form-group">
                        <label for="dayOfWeek">ÊõúÊó•</label>
                        <select id="dayOfWeek" required>
                            <option value="">ÊõúÊó•„ÇíÈÅ∏Êäû</option>
                            <option value="0">Êó•ÊõúÊó•</option>
                            <option value="1">ÊúàÊõúÊó•</option>
                            <option value="2">ÁÅ´ÊõúÊó•</option>
                            <option value="3">Ê∞¥ÊõúÊó•</option>
                            <option value="4">Êú®ÊõúÊó•</option>
                            <option value="5">ÈáëÊõúÊó•</option>
                            <option value="6">ÂúüÊõúÊó•</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weeklyTime">ÊôÇÈñìÂ∏Ø</label>
                        <select id="weeklyTime" required>
                            <option value="">ÊôÇÈñì„ÇíÈÅ∏Êäû</option>
                            <option value="11:00">11:00</option>
                            <option value="12:00">12:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                            <option value="17:00">17:00</option>
                            <option value="18:00">18:00</option>
                            <option value="19:00">19:00</option>
                            <option value="20:00">20:00</option>
                            <option value="21:00">21:00</option>
                            <option value="all">ÁµÇÊó•</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="weeklyType">Âà∂Èôê„Çø„Ç§„Éó</label>
                        <select id="weeklyType" required>
                            <option value="limit">‰∫àÁ¥ÑÊï∞Âà∂Èôê</option>
                            <option value="block">‰∫àÁ¥Ñ„Éñ„É≠„ÉÉ„ÇØ</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="weeklyMaxCapacityGroup">
                        <label for="weeklyMaxCapacity">ÊúÄÂ§ß‰∫àÁ¥ÑÊï∞</label>
                        <input type="number" id="weeklyMaxCapacity" min="0" max="100" value="4">
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <span>‚ûï</span> ÂÆöÊúüÂà∂Èôê„ÇíËøΩÂä†
                    </button>
                </form>
            </div>
        </div>

        <!-- ÁèæÂú®„ÅÆÂà∂Èôê‰∏ÄË¶ß -->
        <div class="card">
            <h2>üìã ÁèæÂú®„ÅÆÂà∂Èôê</h2>
            <div class="restriction-list" id="restrictionList">
                <!-- ÂãïÁöÑ„Å´ÁîüÊàê -->
            </div>
        </div>
    </div>

    <!-- „Çµ„Ç§„Éâ„Éê„Éº„É°„Éã„É•„Éº -->
    <script src='/js/sidebar-menu.js' defer></script>
    
    <script>
        const STORE_ID = new URLSearchParams(window.location.search).get('store_id') || 'default-store';
        let selectedTimes = new Set();
        let currentMode = 'range'; // 'range' or 'individual'
        
        // „É¢„Éº„ÉâÂàá„ÇäÊõø„Åà
        function toggleTimeSelectMode() {
            const modeRadios = document.getElementsByName('timeSelectMode');
            const rangeMode = document.getElementById('timeRangeMode');
            const individualMode = document.getElementById('individualMode');
            
            for (const radio of modeRadios) {
                if (radio.checked) {
                    currentMode = radio.value;
                    break;
                }
            }
            
            if (currentMode === 'range') {
                rangeMode.style.display = 'block';
                individualMode.style.display = 'none';
            } else {
                rangeMode.style.display = 'none';
                individualMode.style.display = 'block';
            }
        }
        
        // ÊôÇÈñì„Çπ„É≠„ÉÉ„Éà„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Ç§„Éô„É≥„Éà
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.addEventListener('click', function() {
                const time = this.dataset.time;
                if (selectedTimes.has(time)) {
                    selectedTimes.delete(time);
                    this.classList.remove('selected');
                } else {
                    selectedTimes.add(time);
                    this.classList.add('selected');
                }
            });
        });
        
        // „ÇØ„Ç§„ÉÉ„ÇØÈÅ∏Êäû„Éú„Çø„É≥
        function selectAllTimes() {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.add('selected');
                selectedTimes.add(slot.dataset.time);
            });
        }
        
        function clearAllTimes() {
            document.querySelectorAll('.time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            selectedTimes.clear();
        }
        
        function selectLunchTime() {
            clearAllTimes();
            ['11:00', '12:00', '13:00', '14:00'].forEach(time => {
                const slot = document.querySelector(`[data-time="${time}"]`);
                if (slot) {
                    slot.classList.add('selected');
                    selectedTimes.add(time);
                }
            });
        }
        
        function selectDinnerTime() {
            clearAllTimes();
            ['17:00', '18:00', '19:00', '20:00', '21:00'].forEach(time => {
                const slot = document.querySelector(`[data-time="${time}"]`);
                if (slot) {
                    slot.classList.add('selected');
                    selectedTimes.add(time);
                }
            });
        }
        
        // Âà∂Èôê„Çø„Ç§„ÉóÂ§âÊõ¥ÊôÇ„ÅÆÂá¶ÁêÜ
        document.getElementById('restrictionType').addEventListener('change', function() {
            const maxCapacityGroup = document.getElementById('maxCapacityGroup');
            if (this.value === 'block') {
                maxCapacityGroup.style.display = 'none';
            } else {
                maxCapacityGroup.style.display = 'block';
            }
        });
        
        document.getElementById('weeklyType').addEventListener('change', function() {
            const weeklyMaxCapacityGroup = document.getElementById('weeklyMaxCapacityGroup');
            if (this.value === 'block') {
                weeklyMaxCapacityGroup.style.display = 'none';
            } else {
                weeklyMaxCapacityGroup.style.display = 'block';
            }
        });
        
        // Êó•‰ªòÊåáÂÆöÂà∂Èôê„ÅÆËøΩÂä†
        document.getElementById('dateRestrictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const date = document.getElementById('restrictionDate').value;
            const type = document.getElementById('restrictionType').value;
            const maxCapacity = type === 'block' ? 0 : document.getElementById('maxCapacity').value;
            const reason = document.getElementById('restrictionReason').value;
            
            // ÊôÇÈñìÂ∏Ø„ÅÆÂèñÂæóÔºà„É¢„Éº„Éâ„Å´„Çà„Å£„Å¶Âá¶ÁêÜ„ÇíÂàÜ„Åë„ÇãÔºâ
            let timesToRestrict = [];
            
            if (currentMode === 'range') {
                // ÊôÇÈñìÁØÑÂõ≤„É¢„Éº„Éâ
                const startTime = document.getElementById('startTime').value;
                const endTime = document.getElementById('endTime').value;
                
                const allTimes = ['11:00', '12:00', '13:00', '14:00', '15:00', '16:00', 
                                 '17:00', '18:00', '19:00', '20:00', '21:00', '22:00'];
                
                const startIndex = allTimes.indexOf(startTime);
                const endIndex = allTimes.indexOf(endTime);
                
                if (startIndex <= endIndex) {
                    timesToRestrict = allTimes.slice(startIndex, endIndex + 1);
                } else {
                    alert('ÁµÇ‰∫ÜÊôÇÈñì„ÅØÈñãÂßãÊôÇÈñì„Çà„ÇäÂæå„Å´Ë®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
            } else {
                // ÂÄãÂà•ÈÅ∏Êäû„É¢„Éº„Éâ
                if (selectedTimes.size === 0) {
                    alert('ÊôÇÈñìÂ∏Ø„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                timesToRestrict = Array.from(selectedTimes);
            }
            
            // LocalStorage„Å´‰øùÂ≠òÔºàÁ∞°ÊòìÂÆüË£ÖÔºâ
            const restrictions = JSON.parse(localStorage.getItem(`restrictions_${STORE_ID}`) || '[]');
            
            // ÈÅ∏Êäû„Åï„Çå„ÅüÂêÑÊôÇÈñìÂ∏Ø„Å´ÂØæ„Åó„Å¶Âà∂Èôê„ÇíËøΩÂä†
            timesToRestrict.forEach(time => {
                restrictions.push({
                    type: 'date',
                    date: date,
                    time: time,
                    capacity: parseInt(maxCapacity),
                    isBlocked: type === 'block',
                    reason: reason,
                    createdAt: new Date().toISOString()
                });
            });
            
            localStorage.setItem(`restrictions_${STORE_ID}`, JSON.stringify(restrictions));
            
            // LocalStorage„ÅÆCapacity Control„É´„Éº„É´„ÇÇÊõ¥Êñ∞Ôºàadmin-full-featured.html„Å®„ÅÆ‰∫íÊèõÊÄßÔºâ
            const capacityKey = `capacity_control_rules_${STORE_ID}`;
            const capacityRules = JSON.parse(localStorage.getItem(capacityKey) || '[]');
            
            timesToRestrict.forEach(time => {
                capacityRules.push({
                    date: date,
                    time: time,
                    maxCapacity: type === 'block' ? 0 : parseInt(maxCapacity),
                    isBlocked: type === 'block',
                    type: 'specific'
                });
            });
            
            localStorage.setItem(capacityKey, JSON.stringify(capacityRules));
            
            alert(`${timesToRestrict.length}‰ª∂„ÅÆÂà∂Èôê„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);
            this.reset();
            clearAllTimes();
            loadRestrictions();
        });
        
        // ÂÆöÊúüÂà∂Èôê„ÅÆËøΩÂä†
        document.getElementById('weeklyRestrictionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const dayOfWeek = document.getElementById('dayOfWeek').value;
            const time = document.getElementById('weeklyTime').value;
            const type = document.getElementById('weeklyType').value;
            const maxCapacity = type === 'block' ? 0 : document.getElementById('weeklyMaxCapacity').value;
            
            try {
                const response = await fetch('/api/reservation-restrictions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'weekly',
                        dayOrDate: dayOfWeek,
                        time: time,
                        capacity: maxCapacity,
                        isBlocked: type === 'block',
                        store_id: STORE_ID
                    })
                });
                
                if (response.ok) {
                    alert('ÂÆöÊúüÂà∂Èôê„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü');
                    this.reset();
                    loadRestrictions();
                } else {
                    alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
            }
        });
        
        // Âà∂Èôê‰∏ÄË¶ß„ÅÆË™≠„ÅøËæº„Åø
        async function loadRestrictions() {
            try {
                // LocalStorage„Åã„ÇâÂèñÂæóÔºàÁ∞°ÊòìÂÆüË£ÖÔºâ
                const restrictions = JSON.parse(localStorage.getItem(`restrictions_${STORE_ID}`) || '[]');
                const capacityRules = JSON.parse(localStorage.getItem(`capacity_control_rules_${STORE_ID}`) || '[]');
                
                // ‰∏°Êñπ„ÅÆ„Éá„Éº„Çø„ÇΩ„Éº„Çπ„ÇíÁµ±Âêà
                const allRestrictions = [...restrictions];
                capacityRules.forEach(rule => {
                    if (!allRestrictions.some(r => r.date === rule.date && r.time === rule.time)) {
                        allRestrictions.push({
                            date: rule.date,
                            time: rule.time,
                            capacity: rule.maxCapacity,
                            isBlocked: rule.isBlocked,
                            type: 'date'
                        });
                    }
                });
                
                const restrictionList = document.getElementById('restrictionList');
                restrictionList.innerHTML = '';
                
                if (allRestrictions.length === 0) {
                    restrictionList.innerHTML = '<p style="text-align: center; color: #999;">Âà∂Èôê„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                    return;
                }
                
                // Êó•‰ªò„Åß„Ç∞„É´„Éº„ÉóÂåñ
                const groupedByDate = {};
                allRestrictions.forEach((restriction, index) => {
                    const key = restriction.date || `ÊØéÈÄ±${['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'][restriction.dayOfWeek]}ÊõúÊó•`;
                    if (!groupedByDate[key]) {
                        groupedByDate[key] = [];
                    }
                    groupedByDate[key].push({ ...restriction, originalIndex: index });
                });
                
                // „Ç∞„É´„Éº„Éó„Åî„Å®„Å´Ë°®Á§∫
                Object.entries(groupedByDate).forEach(([date, dateRestrictions]) => {
                    const dateGroup = document.createElement('div');
                    dateGroup.style.marginBottom = '20px';
                    
                    const dateHeader = document.createElement('div');
                    dateHeader.style.fontWeight = 'bold';
                    dateHeader.style.marginBottom = '10px';
                    dateHeader.style.color = '#333';
                    dateHeader.textContent = date;
                    dateGroup.appendChild(dateHeader);
                    
                    // ÊôÇÈñì„Åß„ÇΩ„Éº„Éà
                    dateRestrictions.sort((a, b) => {
                        if (a.time === 'all') return -1;
                        if (b.time === 'all') return 1;
                        return a.time.localeCompare(b.time);
                    });
                    
                    dateRestrictions.forEach(restriction => {
                        const item = document.createElement('div');
                        item.className = 'restriction-item';
                        
                        const statusClass = restriction.isBlocked ? 'status-blocked' : 'status-limited';
                        const statusText = restriction.isBlocked ? '„Éñ„É≠„ÉÉ„ÇØ' : `ÊúÄÂ§ß${restriction.capacity}ÁµÑ`;
                        
                        item.innerHTML = `
                            <div class="restriction-info">
                                <div class="restriction-date">
                                    ${restriction.time === 'all' ? 'ÁµÇÊó•' : restriction.time}
                                </div>
                                <div class="restriction-details">
                                    ${restriction.reason || ''}
                                </div>
                            </div>
                            <div>
                                <span class="restriction-status ${statusClass}">${statusText}</span>
                                <button class="btn-delete" onclick="deleteRestriction(${restriction.originalIndex})">ÂâäÈô§</button>
                            </div>
                        `;
                        
                        dateGroup.appendChild(item);
                    });
                    
                    restrictionList.appendChild(dateGroup);
                });
            } catch (error) {
                console.error('Error loading restrictions:', error);
            }
        }
        
        // Âà∂Èôê„ÅÆÂâäÈô§
        function deleteRestriction(index) {
            if (confirm('„Åì„ÅÆÂà∂Èôê„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                const restrictions = JSON.parse(localStorage.getItem(`restrictions_${STORE_ID}`) || '[]');
                restrictions.splice(index, 1);
                localStorage.setItem(`restrictions_${STORE_ID}`, JSON.stringify(restrictions));
                loadRestrictions();
            }
        }
        
        // ‰ªäÊó•„ÅÆÊó•‰ªò„Çí„Éá„Éï„Ç©„É´„Éà„Å´Ë®≠ÂÆö
        document.getElementById('restrictionDate').valueAsDate = new Date();
        
        // ÂàùÊúüË™≠„ÅøËæº„Åø
        loadRestrictions();
    </script>
</body>
</html>