<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.5;
        }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: white;
            border-bottom: 1px solid #e0e0e0;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 16px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .view-btn.active {
            background: #06c755;
            color: white;
            border-color: #06c755;
        }
        
        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        /* çµ±è¨ˆã‚«ãƒ¼ãƒ‰ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #1d1d1f;
        }
        
        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ */
        .calendar-view {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .month-year {
            font-size: 20px;
            font-weight: 600;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .nav-btn {
            width: 36px;
            height: 36px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .nav-btn:hover {
            background: #f0f0f0;
        }
        
        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 10px;
        }
        
        .weekday {
            padding: 10px;
            text-align: center;
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        
        .weekday.sunday { color: #ff6b6b; }
        .weekday.saturday { color: #4dabf7; }
        
        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e0e0e0;
            border: 1px solid #e0e0e0;
        }
        
        .day-cell {
            background: white;
            min-height: 100px;
            padding: 8px;
            position: relative;
        }
        
        .day-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .day-cell.other-month .day-number {
            color: #ccc;
        }
        
        .day-cell.today {
            background: #fff9e6;
        }
        
        .day-reservations {
            font-size: 12px;
        }
        
        .reservation-item {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 4px;
            margin-bottom: 2px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .reservation-item:hover {
            background: #1976d2;
            color: white;
        }
        
        /* ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ */
        .list-view {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: #f8f8f8;
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: #666;
            border-bottom: 2px solid #e0e0e0;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 14px;
        }
        
        tr:hover {
            background: #f8f8f8;
        }
        
        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar-header {
                flex-direction: column;
                gap: 10px;
            }
            
            .weekdays, .days-grid {
                font-size: 12px;
            }
            
            .day-cell {
                min-height: 60px;
                padding: 4px;
            }
            
            .day-number {
                font-size: 12px;
            }
            
            .reservation-item {
                font-size: 10px;
                padding: 1px 4px;
            }
            
            /* ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚«ãƒ¼ãƒ‰å½¢å¼ã« */
            table, thead, tbody, th, td, tr {
                display: block;
            }
            
            thead tr {
                display: none;
            }
            
            tr {
                margin-bottom: 10px;
                border: 1px solid #ddd;
                border-radius: 8px;
                padding: 10px;
            }
            
            td {
                border: none;
                padding: 5px 0;
                position: relative;
                padding-left: 35%;
            }
            
            td:before {
                position: absolute;
                left: 0;
                width: 30%;
                font-weight: 600;
                color: #666;
                font-size: 12px;
            }
            
            td:nth-of-type(1):before { content: "ID"; }
            td:nth-of-type(2):before { content: "ãŠåå‰"; }
            td:nth-of-type(3):before { content: "æ—¥ä»˜"; }
            td:nth-of-type(4):before { content: "æ™‚é–“"; }
            td:nth-of-type(5):before { content: "äººæ•°"; }
            td:nth-of-type(6):before { content: "çŠ¶æ…‹"; }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 0 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .stat-card {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 24px;
            }
            
            .view-toggle {
                width: 100%;
            }
            
            .view-btn {
                flex: 1;
                font-size: 14px;
                padding: 6px 8px;
            }
            
            .weekday {
                font-size: 10px;
                padding: 5px;
            }
            
            .day-cell {
                min-height: 50px;
            }
            
            /* å°ç”»é¢ã§ã¯äºˆç´„è©³ç´°ã‚’éè¡¨ç¤º */
            .reservation-item {
                display: none;
            }
            
            .day-cell.has-reservation .day-number::after {
                content: "â—";
                color: #06c755;
                margin-left: 4px;
            }
        }
        
        /* äºˆç´„è¿½åŠ ãƒœã‚¿ãƒ³ */
        .add-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #06c755;
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(6, 199, 85, 0.3);
            transition: all 0.3s;
            z-index: 100;
        }
        
        .add-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(6, 199, 85, 0.4);
        }
        
        @media (max-width: 480px) {
            .add-btn {
                width: 50px;
                height: 50px;
                font-size: 24px;
                bottom: 20px;
                right: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-content">
            <div>
                <h1 style="font-size: 18px; font-weight: 600;">ğŸ“… äºˆç´„ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
            </div>
            <div class="view-toggle">
                <button class="view-btn active" onclick="showView('calendar')">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
                <button class="view-btn" onclick="showView('list')">ãƒªã‚¹ãƒˆ</button>
                <button class="view-btn" onclick="showView('stats')">çµ±è¨ˆ</button>
                <button class="view-btn" onclick="window.location.href='/time-restrictions.html'" style="background: #ff6b35;">ğŸ• æ™‚é–“åˆ¶é™</button>
            </div>
        </div>
    </header>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="container">
        <!-- çµ±è¨ˆ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ä»Šæ—¥ã®äºˆç´„</div>
                <div class="stat-value" id="todayCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">æ˜æ—¥ã®äºˆç´„</div>
                <div class="stat-value" id="tomorrowCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ä»Šé€±ã®äºˆç´„</div>
                <div class="stat-value" id="weekCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ä»Šæœˆã®äºˆç´„</div>
                <div class="stat-value" id="monthCount">0</div>
            </div>
        </div>
        
        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
        <div id="calendarView" class="calendar-view">
            <div class="calendar-header">
                <div class="month-year" id="monthYear">2025å¹´8æœˆ</div>
                <div class="calendar-nav">
                    <button class="nav-btn" onclick="previousMonth()">â€¹</button>
                    <button class="nav-btn" onclick="goToday()">ä»Šæ—¥</button>
                    <button class="nav-btn" onclick="nextMonth()">â€º</button>
                </div>
            </div>
            
            <div class="weekdays">
                <div class="weekday sunday">æ—¥</div>
                <div class="weekday">æœˆ</div>
                <div class="weekday">ç«</div>
                <div class="weekday">æ°´</div>
                <div class="weekday">æœ¨</div>
                <div class="weekday">é‡‘</div>
                <div class="weekday saturday">åœŸ</div>
            </div>
            
            <div class="days-grid" id="daysGrid"></div>
        </div>
        
        <!-- ãƒªã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ -->
        <div id="listView" class="list-view" style="display: none;">
            <div class="filters">
                <select class="filter-select" id="dateFilter">
                    <option value="all">å…¨æœŸé–“</option>
                    <option value="today">ä»Šæ—¥</option>
                    <option value="tomorrow">æ˜æ—¥</option>
                    <option value="week">ä»Šé€±</option>
                    <option value="month">ä»Šæœˆ</option>
                </select>
                <select class="filter-select" id="statusFilter">
                    <option value="all">å…¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</option>
                    <option value="confirmed">ç¢ºèªæ¸ˆã¿</option>
                    <option value="pending">ä¿ç•™ä¸­</option>
                    <option value="cancelled">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
                </select>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ãŠåå‰</th>
                        <th>æ—¥ä»˜</th>
                        <th>æ™‚é–“</th>
                        <th>äººæ•°</th>
                        <th>çŠ¶æ…‹</th>
                    </tr>
                </thead>
                <tbody id="reservationsList"></tbody>
            </table>
        </div>
    </div>
    
    <!-- äºˆç´„è¿½åŠ ãƒœã‚¿ãƒ³ -->
    <button class="add-btn" onclick="openAddModal()">+</button>
    
    <script>
        let currentView = 'calendar';
        let currentMonth = new Date();
        let reservationsData = [];
        
        // ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
        function showView(view) {
            currentView = view;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤º
            document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
            document.getElementById('listView').style.display = view === 'list' ? 'block' : 'none';
            
            if (view === 'stats') {
                document.getElementById('calendarView').style.display = 'none';
                document.getElementById('listView').style.display = 'none';
            }
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
        function previousMonth() {
            currentMonth.setMonth(currentMonth.getMonth() - 1);
            renderCalendar();
        }
        
        function nextMonth() {
            currentMonth.setMonth(currentMonth.getMonth() + 1);
            renderCalendar();
        }
        
        function goToday() {
            currentMonth = new Date();
            renderCalendar();
        }
        
        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
        function renderCalendar() {
            const year = currentMonth.getFullYear();
            const month = currentMonth.getMonth();
            
            document.getElementById('monthYear').textContent = `${year}å¹´${month + 1}æœˆ`;
            
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const daysGrid = document.getElementById('daysGrid');
            
            daysGrid.innerHTML = '';
            
            // å‰æœˆã®æ—¥ä»˜
            for (let i = 0; i < firstDay; i++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell other-month';
                daysGrid.appendChild(dayCell);
            }
            
            // å½“æœˆã®æ—¥ä»˜
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell';
                
                const currentDate = new Date(year, month, day);
                if (currentDate.toDateString() === today.toDateString()) {
                    dayCell.classList.add('today');
                }
                
                const dayNumber = document.createElement('div');
                dayNumber.className = 'day-number';
                dayNumber.textContent = day;
                dayCell.appendChild(dayNumber);
                
                // äºˆç´„æƒ…å ±ã‚’è¿½åŠ ï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãï¼‰
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayReservations = reservationsData.filter(r => r.date === dateStr);
                
                if (dayReservations.length > 0) {
                    dayCell.classList.add('has-reservation');
                    
                    // ãƒ¢ãƒã‚¤ãƒ«ã§ã¯ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã«ã™ã‚‹
                    dayCell.style.cursor = 'pointer';
                    dayCell.onclick = () => handleDayCellClick(dateStr, dayReservations);
                    
                    const reservationsDiv = document.createElement('div');
                    reservationsDiv.className = 'day-reservations';
                    
                    dayReservations.slice(0, 3).forEach(res => {
                        const item = document.createElement('div');
                        item.className = 'reservation-item';
                        item.textContent = `${res.time} ${res.customer_name || res.name || ''}`;
                        reservationsDiv.appendChild(item);
                    });
                    
                    if (dayReservations.length > 3) {
                        const more = document.createElement('div');
                        more.className = 'reservation-item';
                        more.textContent = `ä»–${dayReservations.length - 3}ä»¶`;
                        reservationsDiv.appendChild(more);
                    }
                    
                    dayCell.appendChild(reservationsDiv);
                }
                
                daysGrid.appendChild(dayCell);
            }
        }
        
        // äºˆç´„ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadReservations() {
            try {
                const response = await fetch('/api/reservations');
                reservationsData = await response.json();
                
                // çµ±è¨ˆã‚’æ›´æ–°
                updateStats();
                
                // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†æç”»
                renderCalendar();
                
                // ãƒªã‚¹ãƒˆã‚’æ›´æ–°
                updateList();
            } catch (error) {
                console.error('Error loading reservations:', error);
            }
        }
        
        // çµ±è¨ˆæ›´æ–°
        function updateStats() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            const weekEnd = new Date(today);
            weekEnd.setDate(weekEnd.getDate() + 7);
            
            const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            let todayCount = 0, tomorrowCount = 0, weekCount = 0, monthCount = 0;
            
            reservationsData.forEach(res => {
                const resDate = new Date(res.date);
                if (resDate.toDateString() === today.toDateString()) todayCount++;
                if (resDate.toDateString() === tomorrow.toDateString()) tomorrowCount++;
                if (resDate >= today && resDate <= weekEnd) weekCount++;
                if (resDate >= today && resDate <= monthEnd) monthCount++;
            });
            
            document.getElementById('todayCount').textContent = todayCount;
            document.getElementById('tomorrowCount').textContent = tomorrowCount;
            document.getElementById('weekCount').textContent = weekCount;
            document.getElementById('monthCount').textContent = monthCount;
        }
        
        // ãƒªã‚¹ãƒˆæ›´æ–°
        function updateList() {
            const tbody = document.getElementById('reservationsList');
            tbody.innerHTML = '';
            
            reservationsData.forEach(res => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${res.id}</td>
                    <td>${res.customer_name || res.name || '-'}</td>
                    <td>${res.date}</td>
                    <td>${res.time}</td>
                    <td>${res.people || '-'}å</td>
                    <td>${res.status || 'confirmed'}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadReservations();
        });
        
        // äºˆç´„è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openAddModal() {
            window.location.href = '/admin-calendar.html';
        }
        
        // æ—¥ä»˜ã‚»ãƒ«ã‚¯ãƒªãƒƒã‚¯å‡¦ç†ï¼ˆãƒ¢ãƒã‚¤ãƒ«ç”¨ï¼‰
        function handleDayCellClick(date, reservations) {
            if (window.innerWidth <= 768 && reservations.length > 0) {
                showDayDetails(date, reservations);
            }
        }
        
        // è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
        function showDayDetails(date, reservations) {
            // æ—¢å­˜ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‰Šé™¤
            const existingModal = document.getElementById('dayDetailModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ä½œæˆ
            const modal = document.createElement('div');
            modal.id = 'dayDetailModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                border-radius: 12px;
                max-width: 500px;
                width: 100%;
                max-height: 80vh;
                overflow-y: auto;
                padding: 20px;
            `;
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼
            const header = document.createElement('div');
            header.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;';
            header.innerHTML = `
                <h3 style="font-size: 18px; font-weight: 600;">${date} ã®äºˆç´„</h3>
                <button onclick="document.getElementById('dayDetailModal').remove()" style="background: none; border: none; font-size: 24px; cursor: pointer;">Ã—</button>
            `;
            content.appendChild(header);
            
            // äºˆç´„ãƒªã‚¹ãƒˆ
            const list = document.createElement('div');
            reservations.forEach(res => {
                const item = document.createElement('div');
                item.style.cssText = 'padding: 12px; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 10px;';
                item.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 5px;">${res.time} - ${res.customer_name || res.name || 'åå‰æœªè¨­å®š'}</div>
                    <div style="font-size: 14px; color: #666;">
                        ${res.phone ? `ğŸ“ ${res.phone}<br>` : ''}
                        ${res.email ? `ğŸ“§ ${res.email}<br>` : ''}
                        ${res.people ? `ğŸ‘¥ ${res.people}å<br>` : ''}
                        ${res.message ? `ğŸ’¬ ${res.message}` : ''}
                    </div>
                `;
                list.appendChild(item);
            });
            content.appendChild(list);
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }
    </script>
</body>
</html>