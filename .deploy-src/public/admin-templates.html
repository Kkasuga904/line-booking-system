<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テンプレート管理 - 予約管理システム</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .hamburger-menu {
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
        }

        .hamburger-menu span {
            display: block;
            height: 3px;
            background: #333;
            border-radius: 2px;
            transition: 0.3s;
        }

        .sidebar {
            position: fixed;
            display: none;
            top: 0;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
            overflow-y: auto;
        }

        .sidebar.active {
            display: block;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .sidebar-menu a {
            display: block;
            padding: 15px 20px;
            color: #333;
            text-decoration: none;
            transition: background 0.3s;
        }

        .sidebar-menu a:hover {
            background: #f5f5f5;
        }

        .overlay {
            position: fixed;
            top: 0;
            display: block;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }

        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .template-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .template-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            position: relative;
            transition: box-shadow 0.3s;
        }

        .template-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .template-name {
            font-weight: bold;
            color: #333;
        }

        .template-type {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .template-content {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 14px;
            color: #666;
            max-height: 100px;
            overflow-y: auto;
        }

        .template-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .add-template-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .variables-list {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }

        .variable-tag {
            display: inline-block;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 2px;
            font-family: monospace;
            font-size: 12px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        .variable-tag:hover {
            background: #667eea;
            color: white;
        }

        .template-preview {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .template-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="hamburger-menu" onclick="toggleMenu()">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <h1 class="page-title" onclick="window.location.href='/admin-full-featured.html'">予約管理システム</h1>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>メニュー</h2>
        </div>
        <div class="sidebar-menu">
            <a href="/admin-full-featured.html">ホーム</a>
            <a href="/admin-list.html">予約一覧</a>
            <a href="/capacity-control-enhanced.html">予約制御</a>
            <a href="/seats-management-enhanced.html">席管理</a>
            <a href="/admin-settings.html">営業時間設定</a>
            <a href="/admin-templates.html">テンプレート管理</a>
            <a href="/admin-customers.html">顧客管理</a>
            <a href="/admin-analytics.html">統計・分析</a>
            <a href="/admin-dashboard.html">ダッシュボード</a>
            <a href="/admin-notifications.html">通知センター</a>
            <a href="/admin-advanced.html">詳細設定</a>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="toggleMenu()"></div>

    <div class="container">
        <div class="template-section">
            <h2 class="section-title">新規テンプレート作成</h2>
            <div class="add-template-form">
                <div class="form-group">
                    <label>テンプレート名</label>
                    <input type="text" id="templateName" placeholder="例：予約確認メッセージ">
                </div>
                <div class="form-group">
                    <label>テンプレートタイプ</label>
                    <select id="templateType">
                        <option value="reservation">予約確認</option>
                        <option value="reminder">リマインダー</option>
                        <option value="cancellation">キャンセル確認</option>
                        <option value="thankyou">来店お礼</option>
                        <option value="notification">お知らせ</option>
                        <option value="campaign">キャンペーン</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>メッセージ内容</label>
                    <textarea id="templateContent" placeholder="メッセージを入力してください"></textarea>
                    <div class="variables-list">
                        <small>使用可能な変数（クリックで挿入）：</small><br>
                        <span class="variable-tag" onclick="insertVariable('{customer_name}')">{customer_name}</span>
                        <span class="variable-tag" onclick="insertVariable('{reservation_date}')">{reservation_date}</span>
                        <span class="variable-tag" onclick="insertVariable('{reservation_time}')">{reservation_time}</span>
                        <span class="variable-tag" onclick="insertVariable('{seat_info}')">{seat_info}</span>
                        <span class="variable-tag" onclick="insertVariable('{store_name}')">{store_name}</span>
                        <span class="variable-tag" onclick="insertVariable('{cancel_url}')">{cancel_url}</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>プレビュー</label>
                    <div class="template-preview" id="templatePreview">
                        プレビューがここに表示されます
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addTemplate()">テンプレート追加</button>
            </div>
        </div>

        <div class="template-section">
            <h2 class="section-title">予約関連テンプレート</h2>
            <div class="template-grid" id="reservationTemplates"></div>
        </div>

        <div class="template-section">
            <h2 class="section-title">通知・キャンペーンテンプレート</h2>
            <div class="template-grid" id="notificationTemplates"></div>
        </div>
    </div>

    <script>
        let templates = [
            {
                id: 1,
                name: '予約確認（標準）',
                type: 'reservation',
                content: '{customer_name}様\n\nご予約ありがとうございます。\n以下の内容で予約を承りました。\n\n日時：{reservation_date} {reservation_time}\n席：{seat_info}\n\n変更・キャンセルはこちら：{cancel_url}\n\n{store_name}'
            },
            {
                id: 2,
                name: '前日リマインダー',
                type: 'reminder',
                content: '{customer_name}様\n\n明日のご予約をお忘れなく！\n\n日時：{reservation_date} {reservation_time}\n席：{seat_info}\n\nお待ちしております。\n\n{store_name}'
            },
            {
                id: 3,
                name: 'キャンセル確認',
                type: 'cancellation',
                content: '{customer_name}様\n\nご予約のキャンセルを承りました。\n\nキャンセル日時：{reservation_date} {reservation_time}\n\nまたのご利用をお待ちしております。\n\n{store_name}'
            },
            {
                id: 4,
                name: '来店お礼',
                type: 'thankyou',
                content: '{customer_name}様\n\n本日はご来店いただきありがとうございました。\nまたのお越しをスタッフ一同心よりお待ちしております。\n\n{store_name}'
            }
        ];

        function toggleMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const hamburger = document.querySelector('.hamburger-menu');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
            if (hamburger) {
                hamburger.style.display = sidebar.classList.contains('active') ? 'none' : 'block';
            }
        }

        function renderTemplates() {
            const reservationContainer = document.getElementById('reservationTemplates');
            const notificationContainer = document.getElementById('notificationTemplates');
            
            reservationContainer.innerHTML = '';
            notificationContainer.innerHTML = '';
            
            templates.forEach(template => {
                const card = createTemplateCard(template);
                if (['reservation', 'reminder', 'cancellation', 'thankyou'].includes(template.type)) {
                    reservationContainer.appendChild(card);
                } else {
                    notificationContainer.appendChild(card);
                }
            });
        }

        function createTemplateCard(template) {
            const card = document.createElement('div');
            card.className = 'template-card';
            card.innerHTML = `
                <div class="template-header">
                    <span class="template-name">${template.name}</span>
                    <span class="template-type">${getTypeLabel(template.type)}</span>
                </div>
                <div class="template-content">${template.content}</div>
                <div class="template-actions">
                    <button class="btn btn-primary" onclick="editTemplate(${template.id})">編集</button>
                    <button class="btn btn-secondary" onclick="duplicateTemplate(${template.id})">複製</button>
                    <button class="btn btn-danger" onclick="deleteTemplate(${template.id})">削除</button>
                </div>
            `;
            return card;
        }

        function getTypeLabel(type) {
            const labels = {
                'reservation': '予約確認',
                'reminder': 'リマインダー',
                'cancellation': 'キャンセル',
                'thankyou': 'お礼',
                'notification': 'お知らせ',
                'campaign': 'キャンペーン'
            };
            return labels[type] || type;
        }

        function insertVariable(variable) {
            const textarea = document.getElementById('templateContent');
            const cursorPos = textarea.selectionStart;
            const textBefore = textarea.value.substring(0, cursorPos);
            const textAfter = textarea.value.substring(cursorPos);
            textarea.value = textBefore + variable + textAfter;
            textarea.focus();
            textarea.setSelectionRange(cursorPos + variable.length, cursorPos + variable.length);
            updatePreview();
        }

        function updatePreview() {
            const content = document.getElementById('templateContent').value;
            const preview = document.getElementById('templatePreview');
            
            let previewContent = content
                .replace(/{customer_name}/g, '山田太郎')
                .replace(/{reservation_date}/g, '2025年1月15日')
                .replace(/{reservation_time}/g, '18:00')
                .replace(/{seat_info}/g, 'テーブル席 4名様')
                .replace(/{store_name}/g, 'レストラン Example')
                .replace(/{cancel_url}/g, 'https://example.com/cancel');
            
            preview.textContent = previewContent || 'プレビューがここに表示されます';
        }

        function addTemplate() {
            const name = document.getElementById('templateName').value;
            const type = document.getElementById('templateType').value;
            const content = document.getElementById('templateContent').value;
            
            if (!name || !content) {
                alert('テンプレート名とメッセージ内容を入力してください');
                return;
            }
            
            const newTemplate = {
                id: templates.length + 1,
                name: name,
                type: type,
                content: content
            };
            
            templates.push(newTemplate);
            renderTemplates();
            
            // フォームをクリア
            document.getElementById('templateName').value = '';
            document.getElementById('templateContent').value = '';
            document.getElementById('templatePreview').textContent = 'プレビューがここに表示されます';
            
            alert('テンプレートを追加しました');
        }

        function editTemplate(id) {
            const template = templates.find(t => t.id === id);
            if (template) {
                document.getElementById('templateName').value = template.name;
                document.getElementById('templateType').value = template.type;
                document.getElementById('templateContent').value = template.content;
                updatePreview();
                window.scrollTo(0, 0);
            }
        }

        function duplicateTemplate(id) {
            const template = templates.find(t => t.id === id);
            if (template) {
                const newTemplate = {
                    id: templates.length + 1,
                    name: template.name + ' (コピー)',
                    type: template.type,
                    content: template.content
                };
                templates.push(newTemplate);
                renderTemplates();
                alert('テンプレートを複製しました');
            }
        }

        function deleteTemplate(id) {
            if (confirm('このテンプレートを削除してもよろしいですか？')) {
                templates = templates.filter(t => t.id !== id);
                renderTemplates();
                alert('テンプレートを削除しました');
            }
        }

        // テキストエリアの変更を監視
        document.getElementById('templateContent').addEventListener('input', updatePreview);
        
        // 初期表示
        renderTemplates();
    </script>
</body>
</html>